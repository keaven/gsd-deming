<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="description" content="Learn how to derive group sequential designs for time-to-event endpoints under both proportional and non-proportional hazards assumptions for randomized clinical trials.">
<title>Group Sequential Design Under Non-Proportional Hazards - 3&nbsp; Average hazard ratio</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./pkgs.html" rel="next">
<link href="./proportional-hazards.html" rel="prev">
<link href="./assets/favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
<meta property="og:title" content="Group Sequential Design Under Non-Proportional Hazards - 3&nbsp; Average hazard ratio">
<meta property="og:description" content="Learn how to derive group sequential designs for time-to-event endpoints under both proportional and non-proportional hazards assumptions for randomized clinical trials.">
<meta property="og:image" content="https://keaven.github.io/gsd-deming/assets/preview.jpg">
<meta property="og:site_name" content="Group Sequential Design Under Non-Proportional Hazards">
<meta name="twitter:title" content="Group Sequential Design Under Non-Proportional Hazards - 3&nbsp; Average hazard ratio">
<meta name="twitter:description" content="Learn how to derive group sequential designs for time-to-event endpoints under both proportional and non-proportional hazards assumptions for randomized clinical trials.">
<meta name="twitter:image" content="https://keaven.github.io/gsd-deming/assets/preview.jpg">
<meta name="twitter:card" content="summary_large_image">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./ahr.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Average hazard ratio</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Group Sequential Design Under Non-Proportional Hazards</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/keaven/gsd-deming" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=%7Curl%7C">
              <i class="bi bi-bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
</div>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./background.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Background</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./proportional-hazards.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Proportional hazards</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ahr.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Average hazard ratio</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pkgs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Introduction to gsdmvn, gsDesign2, and simtrial</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./other-tests.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Others tests</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./fixed-design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Fixed design</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wlr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Weighted logrank test</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wlr-boundary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Group sequential design boundary with weighted logrank test</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./maxcombo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">MaxCombo test</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./maxcombo-boundary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Group sequential design boundary with MaxCombo test</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#piecewise-model" id="toc-piecewise-model" class="nav-link active" data-scroll-target="#piecewise-model"><span class="header-section-number">3.1</span> Piecewise model</a></li>
  <li><a href="#sec-secAhr" id="toc-sec-secAhr" class="nav-link" data-scroll-target="#sec-secAhr"><span class="header-section-number">3.2</span> Average hazard ratio</a></li>
  <li>
<a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples"><span class="header-section-number">3.3</span> Examples</a>
  <ul class="collapse">
<li><a href="#sec-SecAhrEgAhrVsTime" id="toc-sec-SecAhrEgAhrVsTime" class="nav-link" data-scroll-target="#sec-SecAhrEgAhrVsTime"><span class="header-section-number">3.3.1</span> Example 1</a></li>
  <li><a href="#sec-SecAhrEgAhrVsPower" id="toc-sec-SecAhrEgAhrVsPower" class="nav-link" data-scroll-target="#sec-SecAhrEgAhrVsPower"><span class="header-section-number">3.3.2</span> Example 2</a></li>
  <li><a href="#sec-SecAhrEgCalcTiming" id="toc-sec-SecAhrEgCalcTiming" class="nav-link" data-scroll-target="#sec-SecAhrEgCalcTiming"><span class="header-section-number">3.3.3</span> Example 3</a></li>
  <li><a href="#sec-SecAhrEgPhNphOneSided" id="toc-sec-SecAhrEgPhNphOneSided" class="nav-link" data-scroll-target="#sec-SecAhrEgPhNphOneSided"><span class="header-section-number">3.3.4</span> Example 4</a></li>
  <li><a href="#sec-AhrEgPhNphSymmetric" id="toc-sec-AhrEgPhNphSymmetric" class="nav-link" data-scroll-target="#sec-AhrEgPhNphSymmetric"><span class="header-section-number">3.3.5</span> Example 5</a></li>
  <li><a href="#sec-AhrEgPhNphAsymmetric" id="toc-sec-AhrEgPhNphAsymmetric" class="nav-link" data-scroll-target="#sec-AhrEgPhNphAsymmetric"><span class="header-section-number">3.3.6</span> Example 6</a></li>
  <li><a href="#sec-AhrEgPhNphSpecStop" id="toc-sec-AhrEgPhNphSpecStop" class="nav-link" data-scroll-target="#sec-AhrEgPhNphSpecStop"><span class="header-section-number">3.3.7</span> Example 7</a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/keaven/gsd-deming/edit/master/ahr.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/keaven/gsd-deming/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li><li><a href="https://github.com/keaven/gsd-deming/blob/master/ahr.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-ahr" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Average hazard ratio</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>We consider designs for non-proportional hazards in this chapter. Because of its importance for regulatory applications, we focus here on the logrank tests. Others tests will be considered in the chapters of the “other tests” part.</p>
<section id="piecewise-model" class="level2" data-number="3.1"><h2 data-number="3.1" class="anchored" data-anchor-id="piecewise-model">
<span class="header-section-number">3.1</span> Piecewise model</h2>
<p>To model a time-varying hazard ratio, we consider a model where failure rates for experimental and control groups are piecewise constant. Since this model can use arbitrarily small piecewise intervals, this is not really a restriction. In concept, this is an extension of the piecewise proportional hazards model of <span class="citation" data-cites="LachinFoulkes">Lachin and Foulkes (<a href="references.html#ref-LachinFoulkes" role="doc-biblioref">1986</a>)</span>. Suppose the piecewise constant changes at the change points <span class="math inline">\(0 = t_0 &lt; t_1 &lt; \cdots &lt; t_M \le \infty\)</span>, and for each individual interval <span class="math inline">\((t_{m-1}, t_m]\)</span> for <span class="math inline">\(m = 1, \ldots, M\)</span>, the hazard ratio is a constant <span class="math inline">\(HR_m\)</span> (experimental:control), i.e.,</p>
<p><span class="math display">\[
  \text{hazard ratio}
  =
  \left\{
  \begin{array}{ll}
    HR_1  &amp; \text{for } t \in (0, t_1] \\
    HR_2  &amp; \text{for } t \in (t_1, t_2] \\
    \vdots \\
    HR_M  &amp; \text{for } t \in (t_{M-1}, t_M] \\
  \end{array}
  \right..
\]</span></p>
<p>For any <span class="math inline">\(m = 1, \ldots, M\)</span>,</p>
<p><span class="math display">\[
  HR_m = \lambda_{1,m} / \lambda_{0,m},
\]</span></p>
<p>where the subscript <span class="math inline">\(i\)</span> indexes the treatment group with <span class="math inline">\(i = 0\)</span> for control arm and <span class="math inline">\(i=1\)</span> for treatment arm. As in <span class="citation" data-cites="LachinFoulkes">Lachin and Foulkes (<a href="references.html#ref-LachinFoulkes" role="doc-biblioref">1986</a>)</span>, we will also assume an exponential dropout rate <span class="math inline">\(\eta_{i,m}\)</span> for treatment arm <span class="math inline">\(i=0,1, m=1,\ldots,M\)</span>. While not necessary, in software implementation in the gsDesign2 and gsdmvn packages, we simplified to <span class="math inline">\(\eta_{0,m}=\eta_{1,m}=\eta_m, m=1,\ldots,M\)</span>.</p>
<p>We will denote</p>
<p><span id="eq-AhrLambdaGamma"><span class="math display">\[
\lambda_{i,m} = e^{\gamma_{i, m}}.
\tag{3.1}\]</span></span></p>
<p>By using the delta method, we get the asymptotic distribution of <span class="math inline">\(\widehat\lambda_{i,m}\)</span> as</p>
<p><span id="eq-AhrIndividualHazardRateDist"><span class="math display">\[
  \log(\widehat\lambda_{i,m})
  \overset{\cdot}{\sim}
  \text{Normal}
  \left(
    \log(\lambda_{i,m}), \; 1/d_{i,m}
  \right),
  \;\;
  \forall i \in \{0, 1\}
\tag{3.2}\]</span></span></p>
<p>With the estimation of <span class="math inline">\(\{\lambda_{i,m}\}_{i=0,1 \text{ and } m = 1, \ldots, M}\)</span>, it is not complicated to get the estimation and the asymptotic distribution of <span class="math inline">\(HR_m\)</span>, which is defined as <span class="math inline">\(HR_m = \lambda_{1,m}/\lambda_{0,m}\)</span>. In this chapter, we are interested in the logarithm of <span class="math inline">\(HR_m\)</span> and denote it as <span class="math inline">\(\beta_m\)</span>. Recall that</p>
<p><span id="eq-AhrSingleHazardRatioDef"><span class="math display">\[
  \beta_m
  \triangleq
  \log(HR_m)
  =
  \log\left( \frac{\lambda_{1,m}}{\lambda_{0,m}} \right)
  =
  \log(\lambda_{1,m}) - \log(\lambda_{0,m}).
\tag{3.3}\]</span></span></p>
<p>For both <span class="math inline">\(\lambda_{1,m}\)</span> and <span class="math inline">\(\lambda_{0,m}\)</span> above, we know they can be estimated by</p>
<p><span class="math display">\[
\widehat\lambda_{i,m} = \frac{d_{i,m}}{T_{i, m}} \;\; i \in\{0, 1\}
\]</span></p>
<p>where <span class="math inline">\(d_{0,m}, d_{1,m}\)</span> are number of events in <span class="math inline">\((t_{m-1}, t_m]\)</span> for group <span class="math inline">\(0,1\)</span>, respectively.</p>
<p>By plugging the asymptotic distribution of <span class="math inline">\(\{\lambda_{0, m}, \lambda_{1,m}\}\)</span> in <a href="#eq-AhrIndividualHazardRateDist" class="quarto-xref">Equation&nbsp;<span>3.2</span></a> into <a href="#eq-AhrSingleHazardRatioDef" class="quarto-xref">Equation&nbsp;<span>3.3</span></a>, we can derive the asymptotic distribution of <span class="math inline">\(\beta_m\)</span>:</p>
<p><span id="eq-AhrSignleLogHazardRatio"><span class="math display">\[
  \widehat\beta_m
  \overset{\cdot}{\sim}
  \text{Normal}
  \left(
    \beta_m,
    \frac{1}{D_{0m}} + \frac{1}{D_{1m}}
  \right)
  \;\; \forall m = 1,\ldots, M .
\tag{3.4}\]</span></span></p>
</section><section id="sec-secAhr" class="level2" data-number="3.2"><h2 data-number="3.2" class="anchored" data-anchor-id="sec-secAhr">
<span class="header-section-number">3.2</span> Average hazard ratio</h2>
<p>In this section, we define the average hazard ratio (AHR) and use it to derive the asymptotic normal distribution of the logrank test. This is actually a weighted geometric mean of the hazard ratio in piecewise intervals we defined above. Defining <span class="math inline">\(\beta_m=\log(\lambda_{1,m}/\lambda_{0,m})= \log(\lambda_{1,m})-\log(\lambda_{0,m}), m=1,\ldots,M\)</span>, we define the logarithm of AHR as a weighted sum of the individual log hazard ratios:</p>
<p><span class="math display">\[
  \beta
  =
  \sum_{m=1}^M w_m \log(HR_m)=\sum_{m=1}^M w_m \beta_m=\sum_{m=1}^Mw_m(\log(\lambda_{1,m})-\log(\lambda_{0,m})).
\]</span></p>
<p>For <span class="math inline">\(w_m\)</span> we propose inverse variance weighting which is based on expected number of events expected in each treatment group in <span class="math inline">\((t_{m-1},t_m],\)</span> <span class="math inline">\(m=1,\ldots,M\)</span>. We denote <span class="math inline">\(d_{i,m}, T_{i,m},\)</span> <span class="math inline">\(i=0,1,\)</span> <span class="math inline">\(m=1,\ldots,M\)</span> the observed events and total time at risk in treatment group <span class="math inline">\(i\)</span> during period <span class="math inline">\((t_{m-1},t_m]\)</span>. Thus, for <span class="math inline">\(m=1,\ldots,M\)</span> we have</p>
<p><span class="math display">\[
w_m=\frac{(1/E(d_{0,m})+1/E(d_{1,m}))^{-1}}{\sum_{j=1}^M (1/E(d_{0,j})+1/E(d_{1,j}))^{-1}}.
\]</span></p>
<p>The corresponding estimate of <span class="math inline">\(\log(\lambda_{i,m}), i=0,1, m=1,\ldots,M\)</span> is</p>
<p><span class="math display">\[
\hat{\gamma}_{i,m}=\log\hat\lambda_{i,m} = \log(d_{i,m}/T_{i,m})
\]</span></p>
<p>which is asymptotically normal with variance</p>
<p><span class="math display">\[
\text{Var}(\hat\gamma_{i,m})=1/E(d_{i,m})
\]</span></p>
<p>and variance estimate</p>
<p><span class="math display">\[
\widehat{\text{Var}}(\hat\gamma_{i,m})=1/d_{i,m}.
\]</span></p>
<p>We propose to estimate <span class="math inline">\(\beta\)</span> using estimated weights under the piecewise model.</p>
<p><span id="eq-AhrBetaEstimation"><span class="math display">\[
  \tilde\beta
  =
  \sum_{m=1}^M
  \hat{w}_m
  \left(\hat\gamma_{1,m} - \hat\gamma_{0,m}\right)
\tag{3.5}\]</span></span></p>
<p>For the selection of weight <span class="math inline">\(\hat{w}_m,\)</span> <span class="math inline">\(m = 1, \ldots, M\)</span>, we use inverse variance weighting</p>
<p><span class="math display">\[
  \hat{w}_m
  =
  \left.
  \left(
    \frac{1}{1/d_{0,m}+1/d_{1,m}}
  \right)^{-1}
  \right/
  \sum_{i=1}^M
  \left(
    \frac{1}{1/d_{0,i}+1/d_{1,i}}
  \right)^{-1}.
\]</span></p>
<p>By plugging the above weights into <a href="#eq-AhrBetaEstimation" class="quarto-xref">Equation&nbsp;<span>3.5</span></a>, <span class="math inline">\(\beta\)</span> can be estimated as</p>
<p><span class="math display">\[
  \tilde\beta
  =
  \frac{
    \sum_{m=1}^M
    \left( \frac{1}{d_{0,m}}+\frac{1}{d_{1,m}} \right)^{-1}
    \left( \log(d_{1,m} / T_{1,m}) - \log(d_{0,m}/T_{0,m}) \right)
  }{
    \sum_{m=1}^M
    \left( \frac{1}{d_{0,m}}+\frac{1}{d_{1,m}} \right)^{-1}
  }.
\]</span></p>
<p>The corresponding variance estimate is:</p>
<p><span class="math display">\[
  \widehat{\hbox{Var}}(\tilde\beta)
  =
  \left(\sum_{m=1}^M(1/d_{0,m} + 1/d_{1,m})^{-1}\right)^{-1}.
\]</span></p>
<p>By plugging the asymptotic distribution of <span class="math inline">\(\hat\beta_m\)</span> in <a href="#eq-AhrSignleLogHazardRatio" class="quarto-xref">Equation&nbsp;<span>3.4</span></a>, one gets the asymptotic distribution of <span class="math inline">\(\tilde\beta\)</span> as</p>
<p><span class="math display">\[
  \tilde\beta
  \overset{\cdot}{\sim}
  \hbox{Normal}(\beta, \; \mathcal{I}^{-1}),
\]</span></p>
<p>where</p>
<p><span class="math display">\[
\mathcal{I} = \sum_{m = 1}^M \left( \frac{1}{E(d_{0,m})} + \frac{1}{E(d_{1,m})} \right)^{-1}.
\]</span></p>
<p>Not shown here is that this is the asymptotic distribution of the logrank test under the piecewise model which follows by the results of <span class="citation" data-cites="Schoenfeld1981">Schoenfeld (<a href="references.html#ref-Schoenfeld1981" role="doc-biblioref">1981</a>)</span>. The details for computing <span class="math inline">\(E(d_{i,m}),\)</span>, <span class="math inline">\(i=0,1\)</span>, <span class="math inline">\(m=1,\ldots,M\)</span> under the piecewise model are demonstrated in a vignette in the gsDesign2 package. These computations form the basis for the asymptotic approximations for power and sample size implemented in the gsdmvn package using the functions <code><a href="https://merck.github.io/gsdmvn/reference/gs_power_ahr.html">gsdmvn::gs_power_ahr()</a></code> and <code><a href="https://merck.github.io/gsdmvn/reference/gs_design_ahr.html">gsdmvn::gs_design_ahr()</a></code>.</p>
</section><section id="examples" class="level2" data-number="3.3"><h2 data-number="3.3" class="anchored" data-anchor-id="examples">
<span class="header-section-number">3.3</span> Examples</h2>
<p>In this section, we introduce 7 examples to help readers:</p>
<ul>
<li>Learn more about AHR by visualization.</li>
<li>Learn the calculation of AHR by using the R package gsDesign2 and gsdmvn.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival">survival</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://gt.rstudio.com">gt</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://merck.github.io/simtrial/">simtrial</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://keaven.github.io/gsDesign/">gsDesign</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://merck.github.io/gsDesign2/">gsDesign2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://merck.github.io/gsdmvn/">gsdmvn</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="sec-SecAhrEgAhrVsTime" class="level3" data-number="3.3.1"><h3 data-number="3.3.1" class="anchored" data-anchor-id="sec-SecAhrEgAhrVsTime">
<span class="header-section-number">3.3.1</span> Example 1</h3>
<p>In this example, we assume the enrollment rate is a constant with <span class="math inline">\(12\)</span> month targeted enrollment. And we further assume the dropout rate is exponential, i.e., <span class="math inline">\(0.001\)</span> per month. Besides, the failure rate is assumed as exponential with the median of <span class="math inline">\(15\)</span> months. The hazard ratio is assumed as <span class="math inline">\(1\)</span> for the first 4 month, and <span class="math inline">\(0.6\)</span> thereafter.</p>
<p>To calculate the AHR, we first use <code><a href="https://merck.github.io/gsDesign2/reference/AHR.html">gsDesign2::AHR()</a></code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># calculate the AHR</span></span>
<span><span class="va">xx</span> <span class="op">&lt;-</span> <span class="fu">gsDesign2</span><span class="fu">::</span><span class="fu"><a href="https://merck.github.io/gsDesign2/reference/AHR.html">AHR</a></span><span class="op">(</span></span>
<span>  <span class="co"># the enrollment rate is a constant with $12$ month targeted enrollment</span></span>
<span>  enrollRates <span class="op">=</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>Stratum <span class="op">=</span> <span class="st">"All"</span>, duration <span class="op">=</span> <span class="fl">12</span>, rate <span class="op">=</span> <span class="fl">100</span> <span class="op">/</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>  failRates <span class="op">=</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>    Stratum <span class="op">=</span> <span class="st">"All"</span>,</span>
<span>    <span class="co"># failure rate is assumed as exponential with the median of 15 months</span></span>
<span>    failRate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fl">15</span>,</span>
<span>    <span class="co"># hazard ratio is assumed as 1 for the first 4 month, and 0.6 thereafter.</span></span>
<span>    hr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.6</span><span class="op">)</span>,</span>
<span>    duration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>    <span class="co"># dropout rate is exponential, i.e., 0.001 per month</span></span>
<span>    dropoutRate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0.001</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="co"># total follow-up from start of enrollment to data cutoff</span></span>
<span>  totalDuration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.001</span>, <span class="fl">4</span>, <span class="fl">4.1</span>, <span class="fl">4.25</span>, <span class="fl">4.5</span>, <span class="fl">5</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">36</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="co"># ratio of experimental to control randomization</span></span>
<span>  ratio <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Its AHR plot can be found below, where its AHR steeps drop after <span class="math inline">\(4\)</span> months and leveling after about <span class="math inline">\(24\)</span> months.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># plot the AHR curve</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">xx</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">AHR</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"AHR (Geometric Average Hazard Ratio) Over Time"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">36</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"AHR"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Month"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">20</span>, y <span class="op">=</span> <span class="fl">.9</span>, size <span class="op">=</span> <span class="fl">6</span>,</span>
<span>    label <span class="op">=</span> <span class="st">"Steep drop after 4 months\n leveling after about 24 months"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>    axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span>, colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,</span>
<span>    axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">18</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>    title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="ahr_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>Then, we are interested to figure out the expected events per <span class="math inline">\(100\)</span> enrolled and find out that we need <span class="math inline">\(35\)</span>-<span class="math inline">\(40\)</span> months until <span class="math inline">\(65\)</span>%-<span class="math inline">\(70\)</span>% have events.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># plot AHR</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="va">xx</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Time</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>Events <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Events</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Events</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">28</span>, y <span class="op">=</span> <span class="fl">20</span>, size <span class="op">=</span> <span class="fl">6</span>,</span>
<span>    label <span class="op">=</span> <span class="st">"Need 35-40 months until\n 65%-70% have events"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">42</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Expected Events per 100 Enrolled"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>    axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">18</span>, colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,</span>
<span>    axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">18</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>    title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Month"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="ahr_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
</section><section id="sec-SecAhrEgAhrVsPower" class="level3" data-number="3.3.2"><h3 data-number="3.3.2" class="anchored" data-anchor-id="sec-SecAhrEgAhrVsPower">
<span class="header-section-number">3.3.2</span> Example 2</h3>
<p>In this example, we assume there are <span class="math inline">\(332\)</span> events and investigate the correlation between AHR and power. For AHR, we are interested in the range from <span class="math inline">\(0.6\)</span> to <span class="math inline">\(1\)</span> with intervals of <span class="math inline">\(0.02\)</span>. For power, it can be calculated by <code><a href="https://keaven.github.io/gsDesign/reference/nSurvival.html">gsDesign::nEvents()</a></code>. The correlation between AHR and power can be found in the following figure.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>    <span class="co"># Interested in the range from 0.6 to 1 with intervals of 0.02</span></span>
<span>    AHR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">.6</span>, <span class="fl">1</span>, <span class="fl">.02</span><span class="op">)</span>,</span>
<span>    <span class="co"># Power can be calculated by gsDesign::nEvents()</span></span>
<span>    Power <span class="op">=</span> <span class="fu">gsDesign</span><span class="fu">::</span><span class="fu"><a href="https://keaven.github.io/gsDesign/reference/nSurvival.html">nEvents</a></span><span class="op">(</span> <span class="co"># assume there are 332 events</span></span>
<span>      n <span class="op">=</span> <span class="fl">332</span>,</span>
<span>      <span class="co"># If beta = NULL and n = number of events,</span></span>
<span>      <span class="co"># then power is computed instead of events required</span></span>
<span>      beta <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>      hr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">.6</span>, <span class="fl">1</span>, <span class="fl">.02</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">AHR</span>, y <span class="op">=</span> <span class="va">Power</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html">percent</a></span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Power by AHR, 332 Events, alpha=0.025, 1-sided"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">.7</span>, y <span class="op">=</span> <span class="fl">.3</span>, size <span class="op">=</span> <span class="fl">6</span>,</span>
<span>    label <span class="op">=</span> <span class="st">"Steep power decrease\n with increasing AHR"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">.88</span>, y <span class="op">=</span> <span class="fl">.83</span>, size <span class="op">=</span> <span class="fl">6</span>,</span>
<span>    label <span class="op">=</span> <span class="st">"Ensure follow-up sufficient\n to capture meaningful AHR"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>    axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">18</span>, colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,</span>
<span>    axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">18</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>    title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="ahr_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
</section><section id="sec-SecAhrEgCalcTiming" class="level3" data-number="3.3.3"><h3 data-number="3.3.3" class="anchored" data-anchor-id="sec-SecAhrEgCalcTiming">
<span class="header-section-number">3.3.3</span> Example 3</h3>
<p>In this example, we discuss the group sequential design with spending bounds. And we will show how to calculate the interim timing, final timing, effect size, and information by <code><a href="https://merck.github.io/gsDesign2/reference/AHR.html">gsDesign2::AHR()</a></code>. We assume the analysis is conducted after <span class="math inline">\(12, 20, 28, 36\)</span> months and the sample size is <span class="math inline">\(500\)</span>. we further assume the enrollment rate is a constant with <span class="math inline">\(12\)</span> month targeted enrollment. And we further assume the dropout rate is exponential, i.e., <span class="math inline">\(0.001\)</span> per month. Besides, the failure rate is assumed as exponential with the median of <span class="math inline">\(15\)</span> months. The hazard ratio is assumed as <span class="math inline">\(1\)</span> for the first <span class="math inline">\(4\)</span> month, and <span class="math inline">\(0.6\)</span> thereafter.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Assume the analysis is conducted after 12, 20, 28, 36 months</span></span>
<span><span class="va">analysisTimes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">20</span>, <span class="fl">28</span>, <span class="fl">36</span><span class="op">)</span></span>
<span><span class="co"># Sample size is 500</span></span>
<span><span class="va">sampleSize</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="co"># Enrollment rates</span></span>
<span><span class="va">enrollRates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  Stratum <span class="op">=</span> <span class="st">"All"</span>,</span>
<span>  <span class="co"># Assume the enrollment rate is a constant with</span></span>
<span>  <span class="co"># 12 month targeted enrollment.</span></span>
<span>  duration <span class="op">=</span> <span class="fl">12</span>,</span>
<span>  rate <span class="op">=</span> <span class="va">sampleSize</span> <span class="op">/</span> <span class="fl">12</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Failure rates</span></span>
<span><span class="va">failRates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  Stratum <span class="op">=</span> <span class="st">"All"</span>,</span>
<span>  <span class="co"># Failure rate is assumed as exponential with the median of 15 months.</span></span>
<span>  failRate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fl">15</span>,</span>
<span>  <span class="co"># Hazard ratio is assumed as $1$ for the first 4 month, and $0.6$ thereafter.</span></span>
<span>  hr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">.6</span><span class="op">)</span>,</span>
<span>  duration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>  <span class="co"># Dropout rate is exponential, i.e., 0.001 per month</span></span>
<span>  dropoutRate <span class="op">=</span> <span class="fl">0.001</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Given the above setting, we can calculate the interim timing, final timing, effect size, and information by <code><a href="https://merck.github.io/gsDesign2/reference/AHR.html">gsDesign2::AHR()</a></code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ahr</span> <span class="op">&lt;-</span> <span class="fu">gsDesign2</span><span class="fu">::</span><span class="fu"><a href="https://merck.github.io/gsDesign2/reference/AHR.html">AHR</a></span><span class="op">(</span></span>
<span>  enrollRates <span class="op">=</span> <span class="va">enrollRates</span>,</span>
<span>  failRates <span class="op">=</span> <span class="va">failRates</span>,</span>
<span>  totalDuration <span class="op">=</span> <span class="va">analysisTimes</span>,</span>
<span>  ratio <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>timing <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">info0</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span> <span class="op">/</span> <span class="va">info0</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ahr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/gt.html">gt</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/fmt_number.html">fmt_number</a></span><span class="op">(</span>col <span class="op">=</span> <span class="fl">2</span>, decimals <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/fmt_number.html">fmt_number</a></span><span class="op">(</span>col <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">6</span>, decimals <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<div id="cnzmrmdcux" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#cnzmrmdcux table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#cnzmrmdcux thead, #cnzmrmdcux tbody, #cnzmrmdcux tfoot, #cnzmrmdcux tr, #cnzmrmdcux td, #cnzmrmdcux th {
  border-style: none;
}

#cnzmrmdcux p {
  margin: 0;
  padding: 0;
}

#cnzmrmdcux .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#cnzmrmdcux .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#cnzmrmdcux .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#cnzmrmdcux .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#cnzmrmdcux .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#cnzmrmdcux .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cnzmrmdcux .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#cnzmrmdcux .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#cnzmrmdcux .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#cnzmrmdcux .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#cnzmrmdcux .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#cnzmrmdcux .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#cnzmrmdcux .gt_spanner_row {
  border-bottom-style: hidden;
}

#cnzmrmdcux .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#cnzmrmdcux .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#cnzmrmdcux .gt_from_md > :first-child {
  margin-top: 0;
}

#cnzmrmdcux .gt_from_md > :last-child {
  margin-bottom: 0;
}

#cnzmrmdcux .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#cnzmrmdcux .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#cnzmrmdcux .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#cnzmrmdcux .gt_row_group_first td {
  border-top-width: 2px;
}

#cnzmrmdcux .gt_row_group_first th {
  border-top-width: 2px;
}

#cnzmrmdcux .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#cnzmrmdcux .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#cnzmrmdcux .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#cnzmrmdcux .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cnzmrmdcux .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#cnzmrmdcux .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#cnzmrmdcux .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#cnzmrmdcux .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#cnzmrmdcux .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cnzmrmdcux .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#cnzmrmdcux .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#cnzmrmdcux .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#cnzmrmdcux .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#cnzmrmdcux .gt_left {
  text-align: left;
}

#cnzmrmdcux .gt_center {
  text-align: center;
}

#cnzmrmdcux .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#cnzmrmdcux .gt_font_normal {
  font-weight: normal;
}

#cnzmrmdcux .gt_font_bold {
  font-weight: bold;
}

#cnzmrmdcux .gt_font_italic {
  font-style: italic;
}

#cnzmrmdcux .gt_super {
  font-size: 65%;
}

#cnzmrmdcux .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#cnzmrmdcux .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#cnzmrmdcux .gt_indent_1 {
  text-indent: 5px;
}

#cnzmrmdcux .gt_indent_2 {
  text-indent: 10px;
}

#cnzmrmdcux .gt_indent_3 {
  text-indent: 15px;
}

#cnzmrmdcux .gt_indent_4 {
  text-indent: 20px;
}

#cnzmrmdcux .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead><tr class="header gt_col_headings">
<th id="Time" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Time</th>
<th id="AHR" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">AHR</th>
<th id="Events" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Events</th>
<th id="info" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">info</th>
<th id="info0" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">info0</th>
<th id="timing" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">timing</th>
</tr></thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="Time">12</td>
<td class="gt_row gt_right" headers="AHR">0.84</td>
<td class="gt_row gt_right" headers="Events">107.39</td>
<td class="gt_row gt_right" headers="info">26.37</td>
<td class="gt_row gt_right" headers="info0">26.85</td>
<td class="gt_row gt_right" headers="timing">0.32</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Time">20</td>
<td class="gt_row gt_right" headers="AHR">0.74</td>
<td class="gt_row gt_right" headers="Events">207.90</td>
<td class="gt_row gt_right" headers="info">50.67</td>
<td class="gt_row gt_right" headers="info0">51.97</td>
<td class="gt_row gt_right" headers="timing">0.63</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="Time">28</td>
<td class="gt_row gt_right" headers="AHR">0.70</td>
<td class="gt_row gt_right" headers="Events">279.10</td>
<td class="gt_row gt_right" headers="info">68.23</td>
<td class="gt_row gt_right" headers="info0">69.78</td>
<td class="gt_row gt_right" headers="timing">0.84</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Time">36</td>
<td class="gt_row gt_right" headers="AHR">0.68</td>
<td class="gt_row gt_right" headers="Events">331.29</td>
<td class="gt_row gt_right" headers="info">81.38</td>
<td class="gt_row gt_right" headers="info0">82.82</td>
<td class="gt_row gt_right" headers="timing">1.00</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section><section id="sec-SecAhrEgPhNphOneSided" class="level3" data-number="3.3.4"><h3 data-number="3.3.4" class="anchored" data-anchor-id="sec-SecAhrEgPhNphOneSided">
<span class="header-section-number">3.3.4</span> Example 4</h3>
<p>In this example, we compare proportional hazard with non-proportional hazard, regarding of the sample size and crossing probability. In this example, we consider the one-sided design. We will discuss the other designs in the next few sections, including symmetric design in <a href="#sec-AhrEgPhNphSymmetric" class="quarto-xref"><span>Section 3.3.5</span></a>, asymmetric design in <a href="#sec-AhrEgPhNphAsymmetric" class="quarto-xref"><span>Section 3.3.6</span></a>, and design with interims at specified times in <a href="#sec-AhrEgPhNphSpecStop" class="quarto-xref"><span>Section 3.3.7</span></a>. For the calculation of proportional hazard, we use R function <code><a href="https://keaven.github.io/gsDesign/reference/nSurv.html">gsDesign::gsSurv()</a></code>. For the calculation of non-proportional hazard, we use R function <code><a href="https://merck.github.io/gsdmvn/reference/gs_design_ahr.html">gsdmvn::gs_design_ahr()</a></code>.</p>
<p>First, we calculate the sample size and crossing probability under proportional hazard. And we find the sample size is <span class="math inline">\(444\)</span> with <span class="math inline">\(297\)</span> events. The crossing probabilities at the first, second, third and final interim analysis are <span class="math inline">\(0.0289, 0.4999, 0.7916, 0.9000\)</span> under <span class="math inline">\(H_1\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Derive Group Sequential Design</span></span>
<span><span class="va">PH1sided</span> <span class="op">&lt;-</span> <span class="fu">gsDesign</span><span class="fu">::</span><span class="fu"><a href="https://keaven.github.io/gsDesign/reference/nSurv.html">gsSurv</a></span><span class="op">(</span></span>
<span>  <span class="co"># Number of analyses (interim + final)</span></span>
<span>  k <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  <span class="co"># use this for 1-sided testing</span></span>
<span>  test.type <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="co"># 1-sided Type I error</span></span>
<span>  alpha <span class="op">=</span> <span class="fl">0.025</span>,</span>
<span>  <span class="co"># Type II error (1 - power)</span></span>
<span>  beta <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  <span class="co"># Information fraction for interim</span></span>
<span>  timing <span class="op">=</span> <span class="va">ahr</span><span class="op">$</span><span class="va">timing</span>,</span>
<span>  <span class="co"># O'Brien-Fleming spending approximation</span></span>
<span>  sfu <span class="op">=</span> <span class="va">sfLDOF</span>,</span>
<span>  <span class="co"># Piecewise control failure rates</span></span>
<span>  lambdaC <span class="op">=</span> <span class="va">failRates</span><span class="op">$</span><span class="va">failRate</span>,</span>
<span>  <span class="co"># Used final analysis AHR</span></span>
<span>  hr <span class="op">=</span> <span class="va">ahr</span><span class="op">$</span><span class="va">AHR</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>,</span>
<span>  <span class="co"># Piecewise exponential dropout rates</span></span>
<span>  eta <span class="op">=</span> <span class="va">failRates</span><span class="op">$</span><span class="va">dropoutRate</span>,</span>
<span>  <span class="co"># Relative enrollment</span></span>
<span>  gamma <span class="op">=</span> <span class="va">enrollRates</span><span class="op">$</span><span class="va">rate</span>,</span>
<span>  <span class="co"># Duration of piecewise enrollment rates</span></span>
<span>  R <span class="op">=</span> <span class="va">enrollRates</span><span class="op">$</span><span class="va">duration</span>,</span>
<span>  <span class="co"># Duration of piecewise failure rates (K-1)</span></span>
<span>  S <span class="op">=</span> <span class="va">failRates</span><span class="op">$</span><span class="va">duration</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  <span class="co"># Study duration</span></span>
<span>  T <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">analysisTimes</span><span class="op">)</span>,</span>
<span>  <span class="co"># Minimum follow-up</span></span>
<span>  minfup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">analysisTimes</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">enrollRates</span><span class="op">$</span><span class="va">duration</span><span class="op">)</span>,</span>
<span>  <span class="co"># Experimental:Control randomization ratio</span></span>
<span>  ratio <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://keaven.github.io/gsDesign/reference/gsBoundSummary.html">gsBoundSummary</a></span><span class="op">(</span><span class="va">PH1sided</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://gt.rstudio.com/reference/gt.html">gt</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<div id="mpuivuawxh" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#mpuivuawxh table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#mpuivuawxh thead, #mpuivuawxh tbody, #mpuivuawxh tfoot, #mpuivuawxh tr, #mpuivuawxh td, #mpuivuawxh th {
  border-style: none;
}

#mpuivuawxh p {
  margin: 0;
  padding: 0;
}

#mpuivuawxh .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#mpuivuawxh .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#mpuivuawxh .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#mpuivuawxh .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#mpuivuawxh .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mpuivuawxh .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mpuivuawxh .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mpuivuawxh .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#mpuivuawxh .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#mpuivuawxh .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#mpuivuawxh .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#mpuivuawxh .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#mpuivuawxh .gt_spanner_row {
  border-bottom-style: hidden;
}

#mpuivuawxh .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#mpuivuawxh .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#mpuivuawxh .gt_from_md > :first-child {
  margin-top: 0;
}

#mpuivuawxh .gt_from_md > :last-child {
  margin-bottom: 0;
}

#mpuivuawxh .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#mpuivuawxh .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#mpuivuawxh .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#mpuivuawxh .gt_row_group_first td {
  border-top-width: 2px;
}

#mpuivuawxh .gt_row_group_first th {
  border-top-width: 2px;
}

#mpuivuawxh .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mpuivuawxh .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#mpuivuawxh .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#mpuivuawxh .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mpuivuawxh .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mpuivuawxh .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#mpuivuawxh .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#mpuivuawxh .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#mpuivuawxh .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mpuivuawxh .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mpuivuawxh .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mpuivuawxh .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mpuivuawxh .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mpuivuawxh .gt_left {
  text-align: left;
}

#mpuivuawxh .gt_center {
  text-align: center;
}

#mpuivuawxh .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#mpuivuawxh .gt_font_normal {
  font-weight: normal;
}

#mpuivuawxh .gt_font_bold {
  font-weight: bold;
}

#mpuivuawxh .gt_font_italic {
  font-style: italic;
}

#mpuivuawxh .gt_super {
  font-size: 65%;
}

#mpuivuawxh .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#mpuivuawxh .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#mpuivuawxh .gt_indent_1 {
  text-indent: 5px;
}

#mpuivuawxh .gt_indent_2 {
  text-indent: 10px;
}

#mpuivuawxh .gt_indent_3 {
  text-indent: 15px;
}

#mpuivuawxh .gt_indent_4 {
  text-indent: 20px;
}

#mpuivuawxh .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead><tr class="header gt_col_headings">
<th id="Analysis" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Analysis</th>
<th id="Value" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Value</th>
<th id="Efficacy" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Efficacy</th>
</tr></thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Analysis">IA 1: 32%</td>
<td class="gt_row gt_left" headers="Value">Z</td>
<td class="gt_row gt_right" headers="Efficacy">3.7670</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Analysis">N: 444</td>
<td class="gt_row gt_left" headers="Value">p (1-sided)</td>
<td class="gt_row gt_right" headers="Efficacy">0.0001</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Analysis">Events: 97</td>
<td class="gt_row gt_left" headers="Value">~HR at bound</td>
<td class="gt_row gt_right" headers="Efficacy">0.4636</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Analysis">Month: 13</td>
<td class="gt_row gt_left" headers="Value">P(Cross) if HR=1</td>
<td class="gt_row gt_right" headers="Efficacy">0.0001</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Analysis"></td>
<td class="gt_row gt_left" headers="Value">P(Cross) if HR=0.68</td>
<td class="gt_row gt_right" headers="Efficacy">0.0289</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Analysis">IA 2: 63%</td>
<td class="gt_row gt_left" headers="Value">Z</td>
<td class="gt_row gt_right" headers="Efficacy">2.6020</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Analysis">N: 444</td>
<td class="gt_row gt_left" headers="Value">p (1-sided)</td>
<td class="gt_row gt_right" headers="Efficacy">0.0046</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Analysis">Events: 186</td>
<td class="gt_row gt_left" headers="Value">~HR at bound</td>
<td class="gt_row gt_right" headers="Efficacy">0.6828</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Analysis">Month: 21</td>
<td class="gt_row gt_left" headers="Value">P(Cross) if HR=1</td>
<td class="gt_row gt_right" headers="Efficacy">0.0047</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Analysis"></td>
<td class="gt_row gt_left" headers="Value">P(Cross) if HR=0.68</td>
<td class="gt_row gt_right" headers="Efficacy">0.4999</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Analysis">IA 3: 84%</td>
<td class="gt_row gt_left" headers="Value">Z</td>
<td class="gt_row gt_right" headers="Efficacy">2.2209</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Analysis">N: 444</td>
<td class="gt_row gt_left" headers="Value">p (1-sided)</td>
<td class="gt_row gt_right" headers="Efficacy">0.0132</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Analysis">Events: 250</td>
<td class="gt_row gt_left" headers="Value">~HR at bound</td>
<td class="gt_row gt_right" headers="Efficacy">0.7549</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Analysis">Month: 28</td>
<td class="gt_row gt_left" headers="Value">P(Cross) if HR=1</td>
<td class="gt_row gt_right" headers="Efficacy">0.0146</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Analysis"></td>
<td class="gt_row gt_left" headers="Value">P(Cross) if HR=0.68</td>
<td class="gt_row gt_right" headers="Efficacy">0.7916</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Analysis">Final</td>
<td class="gt_row gt_left" headers="Value">Z</td>
<td class="gt_row gt_right" headers="Efficacy">2.0453</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Analysis">N: 444</td>
<td class="gt_row gt_left" headers="Value">p (1-sided)</td>
<td class="gt_row gt_right" headers="Efficacy">0.0204</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Analysis">Events: 297</td>
<td class="gt_row gt_left" headers="Value">~HR at bound</td>
<td class="gt_row gt_right" headers="Efficacy">0.7885</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Analysis">Month: 36</td>
<td class="gt_row gt_left" headers="Value">P(Cross) if HR=1</td>
<td class="gt_row gt_right" headers="Efficacy">0.0250</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Analysis"></td>
<td class="gt_row gt_left" headers="Value">P(Cross) if HR=0.68</td>
<td class="gt_row gt_right" headers="Efficacy">0.9000</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Second, we calculate the sample size and crossing probability under non-proportional hazard. And we find the sample size is <span class="math inline">\(465\)</span> with <span class="math inline">\(308\)</span> events (you will want to round up events and sample size). The crossing probabilities at the first, second, third and final interim analysis are <span class="math inline">\(0.0019, 0.3024, 0.7329, 0.9000\)</span> under <span class="math inline">\(H_1\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Spending function setup</span></span>
<span><span class="va">NPH1sided</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://merck.github.io/gsdmvn/reference/gs_design_ahr.html">gs_design_ahr</a></span><span class="op">(</span></span>
<span>  enrollRates <span class="op">=</span> <span class="va">enrollRates</span>,</span>
<span>  failRates <span class="op">=</span> <span class="va">failRates</span>,</span>
<span>  ratio <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">.025</span>, beta <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  <span class="co"># Information fraction not required (but available!)</span></span>
<span>  analysisTimes <span class="op">=</span> <span class="va">analysisTimes</span>,</span>
<span>  <span class="co"># Function to enable spending bound</span></span>
<span>  upper <span class="op">=</span> <span class="va">gs_spending_bound</span>,</span>
<span>  <span class="co"># Spending function and parameters used</span></span>
<span>  upar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>sf <span class="op">=</span> <span class="fu">gsDesign</span><span class="fu">::</span><span class="va"><a href="https://keaven.github.io/gsDesign/reference/sfLDOF.html">sfLDOF</a></span>, total_spend <span class="op">=</span> <span class="fl">0.025</span><span class="op">)</span>,</span>
<span>  <span class="co"># Lower bound fixed at -infinity</span></span>
<span>  lower <span class="op">=</span> <span class="va">gs_b</span>, <span class="co"># allows input of fixed bound</span></span>
<span>  <span class="co"># With gs_b, just enter values for bounds</span></span>
<span>  lpar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">NPH1sided</span><span class="op">$</span><span class="va">bounds</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Bound</span> <span class="op">==</span> <span class="st">"Upper"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/gt.html">gt</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/fmt_number.html">fmt_number</a></span><span class="op">(</span>col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, decimals <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/fmt_number.html">fmt_number</a></span><span class="op">(</span>col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">:</span><span class="fl">11</span><span class="op">)</span>, decimals <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/fmt_number.html">fmt_number</a></span><span class="op">(</span>col <span class="op">=</span> <span class="fl">6</span><span class="op">:</span><span class="fl">7</span>, decimals <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/fmt_number.html">fmt_number</a></span><span class="op">(</span>col <span class="op">=</span> <span class="fl">8</span><span class="op">:</span><span class="fl">9</span>, decimals <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<div id="njzxbytacx" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#njzxbytacx table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#njzxbytacx thead, #njzxbytacx tbody, #njzxbytacx tfoot, #njzxbytacx tr, #njzxbytacx td, #njzxbytacx th {
  border-style: none;
}

#njzxbytacx p {
  margin: 0;
  padding: 0;
}

#njzxbytacx .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#njzxbytacx .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#njzxbytacx .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#njzxbytacx .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#njzxbytacx .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#njzxbytacx .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#njzxbytacx .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#njzxbytacx .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#njzxbytacx .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#njzxbytacx .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#njzxbytacx .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#njzxbytacx .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#njzxbytacx .gt_spanner_row {
  border-bottom-style: hidden;
}

#njzxbytacx .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#njzxbytacx .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#njzxbytacx .gt_from_md > :first-child {
  margin-top: 0;
}

#njzxbytacx .gt_from_md > :last-child {
  margin-bottom: 0;
}

#njzxbytacx .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#njzxbytacx .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#njzxbytacx .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#njzxbytacx .gt_row_group_first td {
  border-top-width: 2px;
}

#njzxbytacx .gt_row_group_first th {
  border-top-width: 2px;
}

#njzxbytacx .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#njzxbytacx .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#njzxbytacx .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#njzxbytacx .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#njzxbytacx .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#njzxbytacx .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#njzxbytacx .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#njzxbytacx .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#njzxbytacx .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#njzxbytacx .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#njzxbytacx .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#njzxbytacx .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#njzxbytacx .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#njzxbytacx .gt_left {
  text-align: left;
}

#njzxbytacx .gt_center {
  text-align: center;
}

#njzxbytacx .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#njzxbytacx .gt_font_normal {
  font-weight: normal;
}

#njzxbytacx .gt_font_bold {
  font-weight: bold;
}

#njzxbytacx .gt_font_italic {
  font-style: italic;
}

#njzxbytacx .gt_super {
  font-size: 65%;
}

#njzxbytacx .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#njzxbytacx .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#njzxbytacx .gt_indent_1 {
  text-indent: 5px;
}

#njzxbytacx .gt_indent_2 {
  text-indent: 10px;
}

#njzxbytacx .gt_indent_3 {
  text-indent: 15px;
}

#njzxbytacx .gt_indent_4 {
  text-indent: 20px;
}

#njzxbytacx .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead><tr class="header gt_col_headings">
<th id="Analysis" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Analysis</th>
<th id="Bound" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Bound</th>
<th id="Time" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Time</th>
<th id="N" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">N</th>
<th id="Events" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Events</th>
<th id="Z" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Z</th>
<th id="Probability" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Probability</th>
<th id="AHR" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">AHR</th>
<th id="theta" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">theta</th>
<th id="info" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">info</th>
<th id="info0" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">info0</th>
</tr></thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="Analysis">1</td>
<td class="gt_row gt_left" headers="Bound">Upper</td>
<td class="gt_row gt_right" headers="Time">12</td>
<td class="gt_row gt_right" headers="N">464.3</td>
<td class="gt_row gt_right" headers="Events">99.7</td>
<td class="gt_row gt_right" headers="Z">3.7670</td>
<td class="gt_row gt_right" headers="Probability">0.0019</td>
<td class="gt_row gt_right" headers="AHR">0.840</td>
<td class="gt_row gt_right" headers="theta">0.175</td>
<td class="gt_row gt_right" headers="info">24.5</td>
<td class="gt_row gt_right" headers="info0">24.9</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Analysis">2</td>
<td class="gt_row gt_left" headers="Bound">Upper</td>
<td class="gt_row gt_right" headers="Time">20</td>
<td class="gt_row gt_right" headers="N">464.3</td>
<td class="gt_row gt_right" headers="Events">193.0</td>
<td class="gt_row gt_right" headers="Z">2.6020</td>
<td class="gt_row gt_right" headers="Probability">0.3024</td>
<td class="gt_row gt_right" headers="AHR">0.738</td>
<td class="gt_row gt_right" headers="theta">0.304</td>
<td class="gt_row gt_right" headers="info">47.0</td>
<td class="gt_row gt_right" headers="info0">48.3</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="Analysis">3</td>
<td class="gt_row gt_left" headers="Bound">Upper</td>
<td class="gt_row gt_right" headers="Time">28</td>
<td class="gt_row gt_right" headers="N">464.3</td>
<td class="gt_row gt_right" headers="Events">259.2</td>
<td class="gt_row gt_right" headers="Z">2.2209</td>
<td class="gt_row gt_right" headers="Probability">0.7329</td>
<td class="gt_row gt_right" headers="AHR">0.700</td>
<td class="gt_row gt_right" headers="theta">0.357</td>
<td class="gt_row gt_right" headers="info">63.3</td>
<td class="gt_row gt_right" headers="info0">64.8</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Analysis">4</td>
<td class="gt_row gt_left" headers="Bound">Upper</td>
<td class="gt_row gt_right" headers="Time">36</td>
<td class="gt_row gt_right" headers="N">464.3</td>
<td class="gt_row gt_right" headers="Events">307.6</td>
<td class="gt_row gt_right" headers="Z">2.0453</td>
<td class="gt_row gt_right" headers="Probability">0.9000</td>
<td class="gt_row gt_right" headers="AHR">0.683</td>
<td class="gt_row gt_right" headers="theta">0.381</td>
<td class="gt_row gt_right" headers="info">75.6</td>
<td class="gt_row gt_right" headers="info0">76.9</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Comparing the proportional hazard with non-proportional hazard, we find that</p>
<ul>
<li>Interim boundary crossing probability much lower than with proportional hazard bounds.</li>
<li>Sample size larger than for proportional hazard.</li>
</ul></section><section id="sec-AhrEgPhNphSymmetric" class="level3" data-number="3.3.5"><h3 data-number="3.3.5" class="anchored" data-anchor-id="sec-AhrEgPhNphSymmetric">
<span class="header-section-number">3.3.5</span> Example 5</h3>
<p>In this example, we compare proportional hazard with non-proportional hazard. Here, we consider the symmetric design:</p>
<p><span class="math display">\[
  \begin{align}
  f(s_k,\alpha)-f(s_{k-1},\alpha)
  =&amp; P_0(\{Z_{k}\geq b_{k}(\alpha)\}\cap_{j=1}^{k-1}\{-b_{j}(\alpha)&lt; Z_{j}&lt; b_{j}(\alpha)\}\\
  =&amp; P_0(\{Z_{k}\le -b_{k}(\alpha)\}\cap_{j=1}^{k-1}\{-b_{j}(\alpha)&lt; Z_{j}&lt; b_{j}(\alpha)\}
  \end{align}.
\]</span></p>
<p>The common practice is to use binding upper and lower bounds. In this example, we use two one-sided tests for <span class="math inline">\(\alpha-\)</span>spending.</p>
<p>First, we calculate the sample size and crossing probability under proportional hazard by <code><a href="https://keaven.github.io/gsDesign/reference/nSurv.html">gsDesign::gsSurv()</a></code>. And we find the sample size is <span class="math inline">\(444\)</span> with <span class="math inline">\(297\)</span> events. The probabilities to cross the upper boundary at the first, second, third and final interim analysis are <span class="math inline">\(0.0289, 0.4999, 0.7916, 0.9000\)</span> under <span class="math inline">\(H_1\)</span>. The probabilities to cross the lower boundary at the first, second, third and final interim analysis are <span class="math inline">\(0.0001, 0.0047, 0.0146, 0.0250\)</span> under <span class="math inline">\(H_0\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div>
<div id="gpfjuwtotc" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#gpfjuwtotc table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#gpfjuwtotc thead, #gpfjuwtotc tbody, #gpfjuwtotc tfoot, #gpfjuwtotc tr, #gpfjuwtotc td, #gpfjuwtotc th {
  border-style: none;
}

#gpfjuwtotc p {
  margin: 0;
  padding: 0;
}

#gpfjuwtotc .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#gpfjuwtotc .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#gpfjuwtotc .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#gpfjuwtotc .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#gpfjuwtotc .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gpfjuwtotc .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gpfjuwtotc .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gpfjuwtotc .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#gpfjuwtotc .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#gpfjuwtotc .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#gpfjuwtotc .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#gpfjuwtotc .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#gpfjuwtotc .gt_spanner_row {
  border-bottom-style: hidden;
}

#gpfjuwtotc .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#gpfjuwtotc .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#gpfjuwtotc .gt_from_md > :first-child {
  margin-top: 0;
}

#gpfjuwtotc .gt_from_md > :last-child {
  margin-bottom: 0;
}

#gpfjuwtotc .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#gpfjuwtotc .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#gpfjuwtotc .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#gpfjuwtotc .gt_row_group_first td {
  border-top-width: 2px;
}

#gpfjuwtotc .gt_row_group_first th {
  border-top-width: 2px;
}

#gpfjuwtotc .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gpfjuwtotc .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#gpfjuwtotc .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#gpfjuwtotc .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gpfjuwtotc .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gpfjuwtotc .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#gpfjuwtotc .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#gpfjuwtotc .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#gpfjuwtotc .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gpfjuwtotc .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gpfjuwtotc .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gpfjuwtotc .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gpfjuwtotc .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gpfjuwtotc .gt_left {
  text-align: left;
}

#gpfjuwtotc .gt_center {
  text-align: center;
}

#gpfjuwtotc .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#gpfjuwtotc .gt_font_normal {
  font-weight: normal;
}

#gpfjuwtotc .gt_font_bold {
  font-weight: bold;
}

#gpfjuwtotc .gt_font_italic {
  font-style: italic;
}

#gpfjuwtotc .gt_super {
  font-size: 65%;
}

#gpfjuwtotc .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#gpfjuwtotc .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#gpfjuwtotc .gt_indent_1 {
  text-indent: 5px;
}

#gpfjuwtotc .gt_indent_2 {
  text-indent: 10px;
}

#gpfjuwtotc .gt_indent_3 {
  text-indent: 15px;
}

#gpfjuwtotc .gt_indent_4 {
  text-indent: 20px;
}

#gpfjuwtotc .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead><tr class="header gt_col_headings">
<th id="Analysis" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Analysis</th>
<th id="Value" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Value</th>
<th id="Efficacy" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Efficacy</th>
<th id="Futility" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Futility</th>
</tr></thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Analysis">IA 1: 32%</td>
<td class="gt_row gt_left" headers="Value">Z</td>
<td class="gt_row gt_right" headers="Efficacy">3.7670</td>
<td class="gt_row gt_right" headers="Futility">-3.7670</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Analysis">N: 444</td>
<td class="gt_row gt_left" headers="Value">p (1-sided)</td>
<td class="gt_row gt_right" headers="Efficacy">0.0001</td>
<td class="gt_row gt_right" headers="Futility">0.0001</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Analysis">Events: 97</td>
<td class="gt_row gt_left" headers="Value">~HR at bound</td>
<td class="gt_row gt_right" headers="Efficacy">0.4636</td>
<td class="gt_row gt_right" headers="Futility">2.1569</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Analysis">Month: 13</td>
<td class="gt_row gt_left" headers="Value">P(Cross) if HR=1</td>
<td class="gt_row gt_right" headers="Efficacy">0.0001</td>
<td class="gt_row gt_right" headers="Futility">0.0001</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Analysis"></td>
<td class="gt_row gt_left" headers="Value">P(Cross) if HR=0.68</td>
<td class="gt_row gt_right" headers="Efficacy">0.0289</td>
<td class="gt_row gt_right" headers="Futility">0.0000</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Analysis">IA 2: 63%</td>
<td class="gt_row gt_left" headers="Value">Z</td>
<td class="gt_row gt_right" headers="Efficacy">2.6020</td>
<td class="gt_row gt_right" headers="Futility">-2.6020</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Analysis">N: 444</td>
<td class="gt_row gt_left" headers="Value">p (1-sided)</td>
<td class="gt_row gt_right" headers="Efficacy">0.0046</td>
<td class="gt_row gt_right" headers="Futility">0.0046</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Analysis">Events: 186</td>
<td class="gt_row gt_left" headers="Value">~HR at bound</td>
<td class="gt_row gt_right" headers="Efficacy">0.6828</td>
<td class="gt_row gt_right" headers="Futility">1.4646</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Analysis">Month: 21</td>
<td class="gt_row gt_left" headers="Value">P(Cross) if HR=1</td>
<td class="gt_row gt_right" headers="Efficacy">0.0047</td>
<td class="gt_row gt_right" headers="Futility">0.0047</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Analysis"></td>
<td class="gt_row gt_left" headers="Value">P(Cross) if HR=0.68</td>
<td class="gt_row gt_right" headers="Efficacy">0.4999</td>
<td class="gt_row gt_right" headers="Futility">0.0000</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Analysis">IA 3: 84%</td>
<td class="gt_row gt_left" headers="Value">Z</td>
<td class="gt_row gt_right" headers="Efficacy">2.2209</td>
<td class="gt_row gt_right" headers="Futility">-2.2209</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Analysis">N: 444</td>
<td class="gt_row gt_left" headers="Value">p (1-sided)</td>
<td class="gt_row gt_right" headers="Efficacy">0.0132</td>
<td class="gt_row gt_right" headers="Futility">0.0132</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Analysis">Events: 250</td>
<td class="gt_row gt_left" headers="Value">~HR at bound</td>
<td class="gt_row gt_right" headers="Efficacy">0.7549</td>
<td class="gt_row gt_right" headers="Futility">1.3246</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Analysis">Month: 28</td>
<td class="gt_row gt_left" headers="Value">P(Cross) if HR=1</td>
<td class="gt_row gt_right" headers="Efficacy">0.0146</td>
<td class="gt_row gt_right" headers="Futility">0.0146</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Analysis"></td>
<td class="gt_row gt_left" headers="Value">P(Cross) if HR=0.68</td>
<td class="gt_row gt_right" headers="Efficacy">0.7916</td>
<td class="gt_row gt_right" headers="Futility">0.0000</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Analysis">Final</td>
<td class="gt_row gt_left" headers="Value">Z</td>
<td class="gt_row gt_right" headers="Efficacy">2.0453</td>
<td class="gt_row gt_right" headers="Futility">-2.0453</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Analysis">N: 444</td>
<td class="gt_row gt_left" headers="Value">p (1-sided)</td>
<td class="gt_row gt_right" headers="Efficacy">0.0204</td>
<td class="gt_row gt_right" headers="Futility">0.0204</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Analysis">Events: 297</td>
<td class="gt_row gt_left" headers="Value">~HR at bound</td>
<td class="gt_row gt_right" headers="Efficacy">0.7885</td>
<td class="gt_row gt_right" headers="Futility">1.2682</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Analysis">Month: 36</td>
<td class="gt_row gt_left" headers="Value">P(Cross) if HR=1</td>
<td class="gt_row gt_right" headers="Efficacy">0.0250</td>
<td class="gt_row gt_right" headers="Futility">0.0250</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Analysis"></td>
<td class="gt_row gt_left" headers="Value">P(Cross) if HR=0.68</td>
<td class="gt_row gt_right" headers="Efficacy">0.9000</td>
<td class="gt_row gt_right" headers="Futility">0.0000</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Second, we calculate the sample size and crossing probability under non-proportional hazard by <code><a href="https://merck.github.io/gsdmvn/reference/gs_design_ahr.html">gsdmvn::gs_design_ahr()</a></code>. And we find the sample size is <span class="math inline">\(465\)</span> with <span class="math inline">\(308\)</span> events (you will want to round up events and sample size). The probabilities to cross the upper boundaries at the first, second, third and final interim analysis are <span class="math inline">\(0.0019, 0.3024, 0.7329, 0.9000\)</span> under <span class="math inline">\(H_1\)</span>. The probabilities to cross the lower boundaries at the first, second, third and final interim analysis are <span class="math inline">\(0.0000, 0.0000, 0.0000, 0.0000\)</span> under <span class="math inline">\(H_0\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">NPHsymmetric</span> <span class="op">&lt;-</span> <span class="fu">gsdmvn</span><span class="fu">::</span><span class="fu"><a href="https://merck.github.io/gsdmvn/reference/gs_design_ahr.html">gs_design_ahr</a></span><span class="op">(</span></span>
<span>  enrollRates <span class="op">=</span> <span class="va">enrollRates</span>,</span>
<span>  failRates <span class="op">=</span> <span class="va">failRates</span>,</span>
<span>  ratio <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">.025</span>, beta <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  <span class="co"># Information fraction not required (but available!)</span></span>
<span>  analysisTimes <span class="op">=</span> <span class="va">analysisTimes</span>,</span>
<span>  <span class="co"># Function to enable spending bound</span></span>
<span>  upper <span class="op">=</span> <span class="va">gs_spending_bound</span>,</span>
<span>  lower <span class="op">=</span> <span class="va">gs_spending_bound</span>,</span>
<span>  <span class="co"># Spending function and parameters used</span></span>
<span>  upar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>sf <span class="op">=</span> <span class="fu">gsDesign</span><span class="fu">::</span><span class="va"><a href="https://keaven.github.io/gsDesign/reference/sfLDOF.html">sfLDOF</a></span>, total_spend <span class="op">=</span> <span class="fl">0.025</span><span class="op">)</span>,</span>
<span>  lpar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>sf <span class="op">=</span> <span class="fu">gsDesign</span><span class="fu">::</span><span class="va"><a href="https://keaven.github.io/gsDesign/reference/sfLDOF.html">sfLDOF</a></span>, total_spend <span class="op">=</span> <span class="fl">0.025</span><span class="op">)</span>,</span>
<span>  binding <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># set lower bound to binding</span></span>
<span>  h1_spending <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">NPHsymmetric</span><span class="op">$</span><span class="va">bounds</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/gt.html">gt</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/fmt_number.html">fmt_number</a></span><span class="op">(</span>col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, decimals <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/fmt_number.html">fmt_number</a></span><span class="op">(</span>col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">:</span><span class="fl">11</span><span class="op">)</span>, decimals <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/fmt_number.html">fmt_number</a></span><span class="op">(</span>col <span class="op">=</span> <span class="fl">6</span><span class="op">:</span><span class="fl">7</span>, decimals <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/fmt_number.html">fmt_number</a></span><span class="op">(</span>col <span class="op">=</span> <span class="fl">8</span><span class="op">:</span><span class="fl">9</span>, decimals <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<div id="hcstblauls" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#hcstblauls table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#hcstblauls thead, #hcstblauls tbody, #hcstblauls tfoot, #hcstblauls tr, #hcstblauls td, #hcstblauls th {
  border-style: none;
}

#hcstblauls p {
  margin: 0;
  padding: 0;
}

#hcstblauls .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#hcstblauls .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#hcstblauls .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#hcstblauls .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#hcstblauls .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hcstblauls .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hcstblauls .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hcstblauls .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#hcstblauls .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#hcstblauls .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#hcstblauls .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#hcstblauls .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#hcstblauls .gt_spanner_row {
  border-bottom-style: hidden;
}

#hcstblauls .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#hcstblauls .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#hcstblauls .gt_from_md > :first-child {
  margin-top: 0;
}

#hcstblauls .gt_from_md > :last-child {
  margin-bottom: 0;
}

#hcstblauls .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#hcstblauls .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#hcstblauls .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#hcstblauls .gt_row_group_first td {
  border-top-width: 2px;
}

#hcstblauls .gt_row_group_first th {
  border-top-width: 2px;
}

#hcstblauls .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hcstblauls .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#hcstblauls .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#hcstblauls .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hcstblauls .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hcstblauls .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#hcstblauls .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#hcstblauls .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#hcstblauls .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hcstblauls .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hcstblauls .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hcstblauls .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hcstblauls .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hcstblauls .gt_left {
  text-align: left;
}

#hcstblauls .gt_center {
  text-align: center;
}

#hcstblauls .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#hcstblauls .gt_font_normal {
  font-weight: normal;
}

#hcstblauls .gt_font_bold {
  font-weight: bold;
}

#hcstblauls .gt_font_italic {
  font-style: italic;
}

#hcstblauls .gt_super {
  font-size: 65%;
}

#hcstblauls .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#hcstblauls .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#hcstblauls .gt_indent_1 {
  text-indent: 5px;
}

#hcstblauls .gt_indent_2 {
  text-indent: 10px;
}

#hcstblauls .gt_indent_3 {
  text-indent: 15px;
}

#hcstblauls .gt_indent_4 {
  text-indent: 20px;
}

#hcstblauls .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead><tr class="header gt_col_headings">
<th id="Analysis" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Analysis</th>
<th id="Bound" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Bound</th>
<th id="Time" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Time</th>
<th id="N" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">N</th>
<th id="Events" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Events</th>
<th id="Z" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Z</th>
<th id="Probability" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Probability</th>
<th id="AHR" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">AHR</th>
<th id="theta" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">theta</th>
<th id="info" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">info</th>
<th id="info0" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">info0</th>
</tr></thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="Analysis">1</td>
<td class="gt_row gt_left" headers="Bound">Upper</td>
<td class="gt_row gt_right" headers="Time">12</td>
<td class="gt_row gt_right" headers="N">464.3</td>
<td class="gt_row gt_right" headers="Events">99.7</td>
<td class="gt_row gt_right" headers="Z">3.7670</td>
<td class="gt_row gt_right" headers="Probability">0.0019</td>
<td class="gt_row gt_right" headers="AHR">0.840</td>
<td class="gt_row gt_right" headers="theta">0.175</td>
<td class="gt_row gt_right" headers="info">24.5</td>
<td class="gt_row gt_right" headers="info0">24.9</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Analysis">2</td>
<td class="gt_row gt_left" headers="Bound">Upper</td>
<td class="gt_row gt_right" headers="Time">20</td>
<td class="gt_row gt_right" headers="N">464.3</td>
<td class="gt_row gt_right" headers="Events">193.0</td>
<td class="gt_row gt_right" headers="Z">2.6020</td>
<td class="gt_row gt_right" headers="Probability">0.3024</td>
<td class="gt_row gt_right" headers="AHR">0.738</td>
<td class="gt_row gt_right" headers="theta">0.304</td>
<td class="gt_row gt_right" headers="info">47.0</td>
<td class="gt_row gt_right" headers="info0">48.3</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="Analysis">3</td>
<td class="gt_row gt_left" headers="Bound">Upper</td>
<td class="gt_row gt_right" headers="Time">28</td>
<td class="gt_row gt_right" headers="N">464.3</td>
<td class="gt_row gt_right" headers="Events">259.2</td>
<td class="gt_row gt_right" headers="Z">2.2209</td>
<td class="gt_row gt_right" headers="Probability">0.7329</td>
<td class="gt_row gt_right" headers="AHR">0.700</td>
<td class="gt_row gt_right" headers="theta">0.357</td>
<td class="gt_row gt_right" headers="info">63.3</td>
<td class="gt_row gt_right" headers="info0">64.8</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Analysis">4</td>
<td class="gt_row gt_left" headers="Bound">Upper</td>
<td class="gt_row gt_right" headers="Time">36</td>
<td class="gt_row gt_right" headers="N">464.3</td>
<td class="gt_row gt_right" headers="Events">307.6</td>
<td class="gt_row gt_right" headers="Z">2.0453</td>
<td class="gt_row gt_right" headers="Probability">0.9000</td>
<td class="gt_row gt_right" headers="AHR">0.683</td>
<td class="gt_row gt_right" headers="theta">0.381</td>
<td class="gt_row gt_right" headers="info">75.6</td>
<td class="gt_row gt_right" headers="info0">76.9</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="Analysis">1</td>
<td class="gt_row gt_left" headers="Bound">Lower</td>
<td class="gt_row gt_right" headers="Time">12</td>
<td class="gt_row gt_right" headers="N">464.3</td>
<td class="gt_row gt_right" headers="Events">99.7</td>
<td class="gt_row gt_right" headers="Z">−3.7670</td>
<td class="gt_row gt_right" headers="Probability">0.0000</td>
<td class="gt_row gt_right" headers="AHR">0.840</td>
<td class="gt_row gt_right" headers="theta">0.175</td>
<td class="gt_row gt_right" headers="info">24.5</td>
<td class="gt_row gt_right" headers="info0">24.9</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Analysis">2</td>
<td class="gt_row gt_left" headers="Bound">Lower</td>
<td class="gt_row gt_right" headers="Time">20</td>
<td class="gt_row gt_right" headers="N">464.3</td>
<td class="gt_row gt_right" headers="Events">193.0</td>
<td class="gt_row gt_right" headers="Z">−2.6020</td>
<td class="gt_row gt_right" headers="Probability">0.0000</td>
<td class="gt_row gt_right" headers="AHR">0.738</td>
<td class="gt_row gt_right" headers="theta">0.304</td>
<td class="gt_row gt_right" headers="info">47.0</td>
<td class="gt_row gt_right" headers="info0">48.3</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="Analysis">3</td>
<td class="gt_row gt_left" headers="Bound">Lower</td>
<td class="gt_row gt_right" headers="Time">28</td>
<td class="gt_row gt_right" headers="N">464.3</td>
<td class="gt_row gt_right" headers="Events">259.2</td>
<td class="gt_row gt_right" headers="Z">−2.2209</td>
<td class="gt_row gt_right" headers="Probability">0.0000</td>
<td class="gt_row gt_right" headers="AHR">0.700</td>
<td class="gt_row gt_right" headers="theta">0.357</td>
<td class="gt_row gt_right" headers="info">63.3</td>
<td class="gt_row gt_right" headers="info0">64.8</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Analysis">4</td>
<td class="gt_row gt_left" headers="Bound">Lower</td>
<td class="gt_row gt_right" headers="Time">36</td>
<td class="gt_row gt_right" headers="N">464.3</td>
<td class="gt_row gt_right" headers="Events">307.6</td>
<td class="gt_row gt_right" headers="Z">−2.0453</td>
<td class="gt_row gt_right" headers="Probability">0.0000</td>
<td class="gt_row gt_right" headers="AHR">0.683</td>
<td class="gt_row gt_right" headers="theta">0.381</td>
<td class="gt_row gt_right" headers="info">75.6</td>
<td class="gt_row gt_right" headers="info0">76.9</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section><section id="sec-AhrEgPhNphAsymmetric" class="level3" data-number="3.3.6"><h3 data-number="3.3.6" class="anchored" data-anchor-id="sec-AhrEgPhNphAsymmetric">
<span class="header-section-number">3.3.6</span> Example 6</h3>
<p>In this example, we compare proportional hazard with non-proportional hazard. Here, we consider the asymmetric design. For upper boundary, we use non-binding upper bound with spending function <span class="math inline">\(f_1(s,\alpha)\)</span>. For lower boundary, we use binding lower bound with spending function <span class="math inline">\(f_2(s,\gamma)\)</span> for some chosen <span class="math inline">\(0 &lt; \gamma \le 1-\alpha\)</span>, where <span class="math inline">\(\gamma\)</span> is the type II error. The boundaries are set to satisfy</p>
<p><span class="math display">\[
  \begin{align}
  f_1(s_k,\alpha)-f_1(s_{k-1},\alpha)
  &amp; = Pr(\{Z_{k}\geq b_{k}(\alpha)\}\cap_{j=1}^{k-1}\{Z_{j}&lt; b_{j}(\alpha) \;|\; H_0\} )\\
  f_2(s_k,\gamma)-f_2(s_{k-1},\gamma)
  &amp; = Pr(\{Z_{k}&lt; a_{k}(\gamma)\}\cap_{j=1}^{k-1}\{a_{j}(\gamma)\le Z_{j}&lt; b_{j}(\alpha)  \;|\; H_1\})
  \end{align}
\]</span></p>
<p>For the last look, <span class="math inline">\(K\)</span>-th look, generally, it is set as <span class="math inline">\(a_K = b_K\)</span>.</p>
<p>First, we calculate the sample size and crossing probability under proportional hazard by <code><a href="https://keaven.github.io/gsDesign/reference/nSurv.html">gsDesign::gsSurv()</a></code>. And we find the sample size is <span class="math inline">\(476\)</span> with <span class="math inline">\(319\)</span> events. The probabilities to cross the upper boundary at the first, second, third and final interim analysis are <span class="math inline">\(0.0338, 0.5385, 0.8185, 0.9000\)</span> under <span class="math inline">\(H_1\)</span>. The probabilities to cross the lower boundary at the first, second, third and final interim analysis are <span class="math inline">\(0.0143, 0.0393, 0.0687, 0.1000\)</span> under <span class="math inline">\(H_1\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Derive Group Sequential Design</span></span>
<span><span class="va">PHasymmetric</span> <span class="op">&lt;-</span> <span class="fu">gsDesign</span><span class="fu">::</span><span class="fu"><a href="https://keaven.github.io/gsDesign/reference/nSurv.html">gsSurv</a></span><span class="op">(</span></span>
<span>  <span class="co"># Number of analyses (interim + final)</span></span>
<span>  k <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  <span class="co"># ONLY CHANGED FROM BEFORE</span></span>
<span>  <span class="co"># non-binding futility bound</span></span>
<span>  test.type <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  <span class="co"># 1-sided Type I error</span></span>
<span>  alpha <span class="op">=</span> <span class="fl">0.025</span>,</span>
<span>  <span class="co"># Type II error (1 - power)</span></span>
<span>  beta <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  <span class="co"># Information fraction for interims</span></span>
<span>  timing <span class="op">=</span> <span class="va">ahr</span><span class="op">$</span><span class="va">timing</span>,</span>
<span>  <span class="co"># O'Brien-Fleming spending approximation</span></span>
<span>  sfu <span class="op">=</span> <span class="va">sfLDOF</span>,</span>
<span>  <span class="co"># Hwang-Shih-DeCani futility spending function</span></span>
<span>  sfl <span class="op">=</span> <span class="va">sfHSD</span>,</span>
<span>  <span class="co"># Accelerate early spending somewhat</span></span>
<span>  sflpar <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>,</span>
<span>  <span class="co"># Piecewise control failure rates</span></span>
<span>  lambdaC <span class="op">=</span> <span class="va">failRates</span><span class="op">$</span><span class="va">failRate</span>,</span>
<span>  <span class="co"># Alternate hypothesis HR</span></span>
<span>  hr <span class="op">=</span> <span class="va">ahr</span><span class="op">$</span><span class="va">AHR</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>,</span>
<span>  <span class="co"># Piecewise exponential dropout rates</span></span>
<span>  eta <span class="op">=</span> <span class="va">failRates</span><span class="op">$</span><span class="va">dropoutRate</span>,</span>
<span>  <span class="co"># Relative enrollment</span></span>
<span>  gamma <span class="op">=</span> <span class="va">enrollRates</span><span class="op">$</span><span class="va">rate</span>,</span>
<span>  <span class="co"># Duration of piecewise enrollment rates</span></span>
<span>  R <span class="op">=</span> <span class="va">enrollRates</span><span class="op">$</span><span class="va">duration</span>,</span>
<span>  <span class="co"># Duration of piecewise failure rates (K-1)</span></span>
<span>  S <span class="op">=</span> <span class="va">failRates</span><span class="op">$</span><span class="va">duration</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  <span class="co"># Study duration</span></span>
<span>  T <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">analysisTimes</span><span class="op">)</span>,</span>
<span>  <span class="co"># Minimum follow-up</span></span>
<span>  minfup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">analysisTimes</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">enrollRates</span><span class="op">$</span><span class="va">duration</span><span class="op">)</span>,</span>
<span>  <span class="co"># Experimental:Control randomization ratio</span></span>
<span>  ratio <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://keaven.github.io/gsDesign/reference/gsBoundSummary.html">gsBoundSummary</a></span><span class="op">(</span><span class="va">PHasymmetric</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://gt.rstudio.com/reference/gt.html">gt</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<div id="brkrlawijs" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#brkrlawijs table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#brkrlawijs thead, #brkrlawijs tbody, #brkrlawijs tfoot, #brkrlawijs tr, #brkrlawijs td, #brkrlawijs th {
  border-style: none;
}

#brkrlawijs p {
  margin: 0;
  padding: 0;
}

#brkrlawijs .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#brkrlawijs .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#brkrlawijs .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#brkrlawijs .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#brkrlawijs .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#brkrlawijs .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#brkrlawijs .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#brkrlawijs .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#brkrlawijs .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#brkrlawijs .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#brkrlawijs .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#brkrlawijs .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#brkrlawijs .gt_spanner_row {
  border-bottom-style: hidden;
}

#brkrlawijs .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#brkrlawijs .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#brkrlawijs .gt_from_md > :first-child {
  margin-top: 0;
}

#brkrlawijs .gt_from_md > :last-child {
  margin-bottom: 0;
}

#brkrlawijs .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#brkrlawijs .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#brkrlawijs .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#brkrlawijs .gt_row_group_first td {
  border-top-width: 2px;
}

#brkrlawijs .gt_row_group_first th {
  border-top-width: 2px;
}

#brkrlawijs .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#brkrlawijs .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#brkrlawijs .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#brkrlawijs .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#brkrlawijs .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#brkrlawijs .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#brkrlawijs .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#brkrlawijs .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#brkrlawijs .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#brkrlawijs .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#brkrlawijs .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#brkrlawijs .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#brkrlawijs .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#brkrlawijs .gt_left {
  text-align: left;
}

#brkrlawijs .gt_center {
  text-align: center;
}

#brkrlawijs .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#brkrlawijs .gt_font_normal {
  font-weight: normal;
}

#brkrlawijs .gt_font_bold {
  font-weight: bold;
}

#brkrlawijs .gt_font_italic {
  font-style: italic;
}

#brkrlawijs .gt_super {
  font-size: 65%;
}

#brkrlawijs .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#brkrlawijs .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#brkrlawijs .gt_indent_1 {
  text-indent: 5px;
}

#brkrlawijs .gt_indent_2 {
  text-indent: 10px;
}

#brkrlawijs .gt_indent_3 {
  text-indent: 15px;
}

#brkrlawijs .gt_indent_4 {
  text-indent: 20px;
}

#brkrlawijs .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead><tr class="header gt_col_headings">
<th id="Analysis" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Analysis</th>
<th id="Value" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Value</th>
<th id="Efficacy" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Efficacy</th>
<th id="Futility" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Futility</th>
</tr></thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Analysis">IA 1: 32%</td>
<td class="gt_row gt_left" headers="Value">Z</td>
<td class="gt_row gt_right" headers="Efficacy">3.7670</td>
<td class="gt_row gt_right" headers="Futility">-0.2503</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Analysis">N: 476</td>
<td class="gt_row gt_left" headers="Value">p (1-sided)</td>
<td class="gt_row gt_right" headers="Efficacy">0.0001</td>
<td class="gt_row gt_right" headers="Futility">0.5988</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Analysis">Events: 104</td>
<td class="gt_row gt_left" headers="Value">~HR at bound</td>
<td class="gt_row gt_right" headers="Efficacy">0.4767</td>
<td class="gt_row gt_right" headers="Futility">1.0505</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Analysis">Month: 13</td>
<td class="gt_row gt_left" headers="Value">P(Cross) if HR=1</td>
<td class="gt_row gt_right" headers="Efficacy">0.0001</td>
<td class="gt_row gt_right" headers="Futility">0.4012</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Analysis"></td>
<td class="gt_row gt_left" headers="Value">P(Cross) if HR=0.68</td>
<td class="gt_row gt_right" headers="Efficacy">0.0338</td>
<td class="gt_row gt_right" headers="Futility">0.0143</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Analysis">IA 2: 63%</td>
<td class="gt_row gt_left" headers="Value">Z</td>
<td class="gt_row gt_right" headers="Efficacy">2.6020</td>
<td class="gt_row gt_right" headers="Futility">0.8440</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Analysis">N: 476</td>
<td class="gt_row gt_left" headers="Value">p (1-sided)</td>
<td class="gt_row gt_right" headers="Efficacy">0.0046</td>
<td class="gt_row gt_right" headers="Futility">0.1993</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Analysis">Events: 201</td>
<td class="gt_row gt_left" headers="Value">~HR at bound</td>
<td class="gt_row gt_right" headers="Efficacy">0.6922</td>
<td class="gt_row gt_right" headers="Futility">0.8875</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Analysis">Month: 21</td>
<td class="gt_row gt_left" headers="Value">P(Cross) if HR=1</td>
<td class="gt_row gt_right" headers="Efficacy">0.0047</td>
<td class="gt_row gt_right" headers="Futility">0.8103</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Analysis"></td>
<td class="gt_row gt_left" headers="Value">P(Cross) if HR=0.68</td>
<td class="gt_row gt_right" headers="Efficacy">0.5385</td>
<td class="gt_row gt_right" headers="Futility">0.0393</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Analysis">IA 3: 84%</td>
<td class="gt_row gt_left" headers="Value">Z</td>
<td class="gt_row gt_right" headers="Efficacy">2.2209</td>
<td class="gt_row gt_right" headers="Futility">1.5151</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Analysis">N: 476</td>
<td class="gt_row gt_left" headers="Value">p (1-sided)</td>
<td class="gt_row gt_right" headers="Efficacy">0.0132</td>
<td class="gt_row gt_right" headers="Futility">0.0649</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Analysis">Events: 269</td>
<td class="gt_row gt_left" headers="Value">~HR at bound</td>
<td class="gt_row gt_right" headers="Efficacy">0.7626</td>
<td class="gt_row gt_right" headers="Futility">0.8312</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Analysis">Month: 28</td>
<td class="gt_row gt_left" headers="Value">P(Cross) if HR=1</td>
<td class="gt_row gt_right" headers="Efficacy">0.0144</td>
<td class="gt_row gt_right" headers="Futility">0.9414</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Analysis"></td>
<td class="gt_row gt_left" headers="Value">P(Cross) if HR=0.68</td>
<td class="gt_row gt_right" headers="Efficacy">0.8185</td>
<td class="gt_row gt_right" headers="Futility">0.0687</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Analysis">Final</td>
<td class="gt_row gt_left" headers="Value">Z</td>
<td class="gt_row gt_right" headers="Efficacy">2.0453</td>
<td class="gt_row gt_right" headers="Futility">2.0453</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Analysis">N: 476</td>
<td class="gt_row gt_left" headers="Value">p (1-sided)</td>
<td class="gt_row gt_right" headers="Efficacy">0.0204</td>
<td class="gt_row gt_right" headers="Futility">0.0204</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Analysis">Events: 319</td>
<td class="gt_row gt_left" headers="Value">~HR at bound</td>
<td class="gt_row gt_right" headers="Efficacy">0.7953</td>
<td class="gt_row gt_right" headers="Futility">0.7953</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Analysis">Month: 36</td>
<td class="gt_row gt_left" headers="Value">P(Cross) if HR=1</td>
<td class="gt_row gt_right" headers="Efficacy">0.0225</td>
<td class="gt_row gt_right" headers="Futility">0.9775</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Analysis"></td>
<td class="gt_row gt_left" headers="Value">P(Cross) if HR=0.68</td>
<td class="gt_row gt_right" headers="Efficacy">0.9000</td>
<td class="gt_row gt_right" headers="Futility">0.1000</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Second, we calculate the sample size and crossing probability under non-proportional hazard by <code><a href="https://merck.github.io/gsdmvn/reference/gs_design_ahr.html">gsdmvn::gs_design_ahr()</a></code>. And we find the sample size is <span class="math inline">\(502\)</span> with <span class="math inline">\(333\)</span> events (you will want to round up events and sample size). The probabilities to cross the upper boundaries at the first, second, third and final interim analysis are <span class="math inline">\(0.0021, 0.3318, 0.7660, 0.9000\)</span> under <span class="math inline">\(H_1\)</span>. The probabilities to cross the lower boundaries at the first, second, third and final interim analysis are <span class="math inline">\(0.0143, 0.0387, 0.0681, 0.1000\)</span> under <span class="math inline">\(H_0\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">NPHasymmetric</span> <span class="op">&lt;-</span> <span class="fu">gsdmvn</span><span class="fu">::</span><span class="fu"><a href="https://merck.github.io/gsdmvn/reference/gs_design_ahr.html">gs_design_ahr</a></span><span class="op">(</span></span>
<span>  enrollRates <span class="op">=</span> <span class="va">enrollRates</span>,</span>
<span>  failRates <span class="op">=</span> <span class="va">failRates</span>,</span>
<span>  ratio <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">.025</span>, beta <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  <span class="co"># Information fraction not required (but available!)</span></span>
<span>  analysisTimes <span class="op">=</span> <span class="va">analysisTimes</span>,</span>
<span>  <span class="co"># Function to enable spending bound</span></span>
<span>  upper <span class="op">=</span> <span class="va">gs_spending_bound</span>,</span>
<span>  lower <span class="op">=</span> <span class="va">gs_spending_bound</span>,</span>
<span>  <span class="co"># Spending function and parameters used</span></span>
<span>  upar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>sf <span class="op">=</span> <span class="fu">gsDesign</span><span class="fu">::</span><span class="va"><a href="https://keaven.github.io/gsDesign/reference/sfLDOF.html">sfLDOF</a></span>, total_spend <span class="op">=</span> <span class="fl">0.025</span><span class="op">)</span>,</span>
<span>  lpar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>sf <span class="op">=</span> <span class="fu">gsDesign</span><span class="fu">::</span><span class="va"><a href="https://keaven.github.io/gsDesign/reference/sfHSD.html">sfHSD</a></span>, total_spend <span class="op">=</span> <span class="fl">.1</span>, param <span class="op">=</span> <span class="op">-</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">NPHasymmetric</span><span class="op">$</span><span class="va">bounds</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/gt.html">gt</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/fmt_number.html">fmt_number</a></span><span class="op">(</span>col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, decimals <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/fmt_number.html">fmt_number</a></span><span class="op">(</span>col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">:</span><span class="fl">11</span><span class="op">)</span>, decimals <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/fmt_number.html">fmt_number</a></span><span class="op">(</span>col <span class="op">=</span> <span class="fl">6</span><span class="op">:</span><span class="fl">7</span>, decimals <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/fmt_number.html">fmt_number</a></span><span class="op">(</span>col <span class="op">=</span> <span class="fl">8</span><span class="op">:</span><span class="fl">9</span>, decimals <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<div id="bluyxoadwl" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#bluyxoadwl table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#bluyxoadwl thead, #bluyxoadwl tbody, #bluyxoadwl tfoot, #bluyxoadwl tr, #bluyxoadwl td, #bluyxoadwl th {
  border-style: none;
}

#bluyxoadwl p {
  margin: 0;
  padding: 0;
}

#bluyxoadwl .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#bluyxoadwl .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#bluyxoadwl .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#bluyxoadwl .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#bluyxoadwl .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#bluyxoadwl .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bluyxoadwl .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#bluyxoadwl .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#bluyxoadwl .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#bluyxoadwl .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#bluyxoadwl .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#bluyxoadwl .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#bluyxoadwl .gt_spanner_row {
  border-bottom-style: hidden;
}

#bluyxoadwl .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#bluyxoadwl .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#bluyxoadwl .gt_from_md > :first-child {
  margin-top: 0;
}

#bluyxoadwl .gt_from_md > :last-child {
  margin-bottom: 0;
}

#bluyxoadwl .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#bluyxoadwl .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#bluyxoadwl .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#bluyxoadwl .gt_row_group_first td {
  border-top-width: 2px;
}

#bluyxoadwl .gt_row_group_first th {
  border-top-width: 2px;
}

#bluyxoadwl .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#bluyxoadwl .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#bluyxoadwl .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#bluyxoadwl .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bluyxoadwl .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#bluyxoadwl .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#bluyxoadwl .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#bluyxoadwl .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#bluyxoadwl .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bluyxoadwl .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#bluyxoadwl .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#bluyxoadwl .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#bluyxoadwl .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#bluyxoadwl .gt_left {
  text-align: left;
}

#bluyxoadwl .gt_center {
  text-align: center;
}

#bluyxoadwl .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#bluyxoadwl .gt_font_normal {
  font-weight: normal;
}

#bluyxoadwl .gt_font_bold {
  font-weight: bold;
}

#bluyxoadwl .gt_font_italic {
  font-style: italic;
}

#bluyxoadwl .gt_super {
  font-size: 65%;
}

#bluyxoadwl .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#bluyxoadwl .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#bluyxoadwl .gt_indent_1 {
  text-indent: 5px;
}

#bluyxoadwl .gt_indent_2 {
  text-indent: 10px;
}

#bluyxoadwl .gt_indent_3 {
  text-indent: 15px;
}

#bluyxoadwl .gt_indent_4 {
  text-indent: 20px;
}

#bluyxoadwl .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead><tr class="header gt_col_headings">
<th id="Analysis" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Analysis</th>
<th id="Bound" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Bound</th>
<th id="Time" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Time</th>
<th id="N" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">N</th>
<th id="Events" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Events</th>
<th id="Z" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Z</th>
<th id="Probability" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Probability</th>
<th id="AHR" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">AHR</th>
<th id="theta" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">theta</th>
<th id="info" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">info</th>
<th id="info0" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">info0</th>
</tr></thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="Analysis">1</td>
<td class="gt_row gt_left" headers="Bound">Upper</td>
<td class="gt_row gt_right" headers="Time">12</td>
<td class="gt_row gt_right" headers="N">501.8</td>
<td class="gt_row gt_right" headers="Events">107.8</td>
<td class="gt_row gt_right" headers="Z">3.7670</td>
<td class="gt_row gt_right" headers="Probability">0.0021</td>
<td class="gt_row gt_right" headers="AHR">0.840</td>
<td class="gt_row gt_right" headers="theta">0.175</td>
<td class="gt_row gt_right" headers="info">26.5</td>
<td class="gt_row gt_right" headers="info0">26.9</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Analysis">2</td>
<td class="gt_row gt_left" headers="Bound">Upper</td>
<td class="gt_row gt_right" headers="Time">20</td>
<td class="gt_row gt_right" headers="N">501.8</td>
<td class="gt_row gt_right" headers="Events">208.6</td>
<td class="gt_row gt_right" headers="Z">2.6020</td>
<td class="gt_row gt_right" headers="Probability">0.3318</td>
<td class="gt_row gt_right" headers="AHR">0.738</td>
<td class="gt_row gt_right" headers="theta">0.304</td>
<td class="gt_row gt_right" headers="info">50.9</td>
<td class="gt_row gt_right" headers="info0">52.2</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="Analysis">3</td>
<td class="gt_row gt_left" headers="Bound">Upper</td>
<td class="gt_row gt_right" headers="Time">28</td>
<td class="gt_row gt_right" headers="N">501.8</td>
<td class="gt_row gt_right" headers="Events">280.1</td>
<td class="gt_row gt_right" headers="Z">2.2209</td>
<td class="gt_row gt_right" headers="Probability">0.7660</td>
<td class="gt_row gt_right" headers="AHR">0.700</td>
<td class="gt_row gt_right" headers="theta">0.357</td>
<td class="gt_row gt_right" headers="info">68.5</td>
<td class="gt_row gt_right" headers="info0">70.0</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Analysis">4</td>
<td class="gt_row gt_left" headers="Bound">Upper</td>
<td class="gt_row gt_right" headers="Time">36</td>
<td class="gt_row gt_right" headers="N">501.8</td>
<td class="gt_row gt_right" headers="Events">332.5</td>
<td class="gt_row gt_right" headers="Z">2.0453</td>
<td class="gt_row gt_right" headers="Probability">0.9000</td>
<td class="gt_row gt_right" headers="AHR">0.683</td>
<td class="gt_row gt_right" headers="theta">0.381</td>
<td class="gt_row gt_right" headers="info">81.7</td>
<td class="gt_row gt_right" headers="info0">83.1</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="Analysis">1</td>
<td class="gt_row gt_left" headers="Bound">Lower</td>
<td class="gt_row gt_right" headers="Time">12</td>
<td class="gt_row gt_right" headers="N">501.8</td>
<td class="gt_row gt_right" headers="Events">107.8</td>
<td class="gt_row gt_right" headers="Z">−1.2899</td>
<td class="gt_row gt_right" headers="Probability">0.0143</td>
<td class="gt_row gt_right" headers="AHR">0.840</td>
<td class="gt_row gt_right" headers="theta">0.175</td>
<td class="gt_row gt_right" headers="info">26.5</td>
<td class="gt_row gt_right" headers="info0">26.9</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Analysis">2</td>
<td class="gt_row gt_left" headers="Bound">Lower</td>
<td class="gt_row gt_right" headers="Time">20</td>
<td class="gt_row gt_right" headers="N">501.8</td>
<td class="gt_row gt_right" headers="Events">208.6</td>
<td class="gt_row gt_right" headers="Z">0.3054</td>
<td class="gt_row gt_right" headers="Probability">0.0387</td>
<td class="gt_row gt_right" headers="AHR">0.738</td>
<td class="gt_row gt_right" headers="theta">0.304</td>
<td class="gt_row gt_right" headers="info">50.9</td>
<td class="gt_row gt_right" headers="info0">52.2</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="Analysis">3</td>
<td class="gt_row gt_left" headers="Bound">Lower</td>
<td class="gt_row gt_right" headers="Time">28</td>
<td class="gt_row gt_right" headers="N">501.8</td>
<td class="gt_row gt_right" headers="Events">280.1</td>
<td class="gt_row gt_right" headers="Z">1.3340</td>
<td class="gt_row gt_right" headers="Probability">0.0681</td>
<td class="gt_row gt_right" headers="AHR">0.700</td>
<td class="gt_row gt_right" headers="theta">0.357</td>
<td class="gt_row gt_right" headers="info">68.5</td>
<td class="gt_row gt_right" headers="info0">70.0</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Analysis">4</td>
<td class="gt_row gt_left" headers="Bound">Lower</td>
<td class="gt_row gt_right" headers="Time">36</td>
<td class="gt_row gt_right" headers="N">501.8</td>
<td class="gt_row gt_right" headers="Events">332.5</td>
<td class="gt_row gt_right" headers="Z">2.0453</td>
<td class="gt_row gt_right" headers="Probability">0.1000</td>
<td class="gt_row gt_right" headers="AHR">0.683</td>
<td class="gt_row gt_right" headers="theta">0.381</td>
<td class="gt_row gt_right" headers="info">81.7</td>
<td class="gt_row gt_right" headers="info0">83.1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>This does important adjustment to futility bounds based on possibly delayed effect! - Note IA 1 futility bound under PH with <code><a href="https://keaven.github.io/gsDesign/reference/gsDesign.html">gsDesign()</a></code>: <span class="math inline">\(Z=-0.25\)</span></p>
</section><section id="sec-AhrEgPhNphSpecStop" class="level3" data-number="3.3.7"><h3 data-number="3.3.7" class="anchored" data-anchor-id="sec-AhrEgPhNphSpecStop">
<span class="header-section-number">3.3.7</span> Example 7</h3>
<p>In this example, we discuss the design with interims at specified times, say, there are futility boundary only at the first interim analysis (look for <span class="math inline">\(p=0.05\)</span> in the wrong direction) and there are efficacy boundaries only after the first interim. This is a variation on asymmetric design. It should be noted that it is not easily done with <code><a href="https://keaven.github.io/gsDesign/reference/nSurv.html">gsDesign::gsSurv()</a></code>, and cannot be done (at least not easily) with the gsDesign package. So, we only discuss the implementation of <code><a href="https://merck.github.io/gsdmvn/reference/gs_design_ahr.html">gsdmvn::gs_design_ahr()</a></code> for design with interims at specified times. We will use information fraction instead of calendar times of analysis.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">NPHskip</span> <span class="op">&lt;-</span> <span class="fu">gsdmvn</span><span class="fu">::</span><span class="fu"><a href="https://merck.github.io/gsdmvn/reference/gs_design_ahr.html">gs_design_ahr</a></span><span class="op">(</span></span>
<span>  enrollRates <span class="op">=</span> <span class="va">enrollRates</span>,</span>
<span>  failRates <span class="op">=</span> <span class="va">failRates</span>,</span>
<span>  ratio <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">.025</span>, beta <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  <span class="co"># Information fraction not required (but available!)</span></span>
<span>  analysisTimes <span class="op">=</span> <span class="va">analysisTimes</span>,</span>
<span>  <span class="co"># Upper spending bound</span></span>
<span>  upper <span class="op">=</span> <span class="va">gs_spending_bound</span>,</span>
<span>  upar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>sf <span class="op">=</span> <span class="fu">gsDesign</span><span class="fu">::</span><span class="va"><a href="https://keaven.github.io/gsDesign/reference/sfLDOF.html">sfLDOF</a></span>, total_spend <span class="op">=</span> <span class="fl">0.025</span><span class="op">)</span>,</span>
<span>  <span class="co"># Skip first efficacy analysis</span></span>
<span>  test_upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  <span class="co"># Spending function and parameters used</span></span>
<span>  lower <span class="op">=</span> <span class="va">gs_b</span>,</span>
<span>  lpar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="fl">.05</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">NPHskip</span><span class="op">$</span><span class="va">bounds</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span> <span class="op">&lt;</span> <span class="cn">Inf</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># Throw out infinite bounds</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">Analysis</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># Arrange by analysis</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/gt.html">gt</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/fmt_number.html">fmt_number</a></span><span class="op">(</span>columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, decimals <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/fmt_number.html">fmt_number</a></span><span class="op">(</span>columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">:</span><span class="fl">11</span><span class="op">)</span>, decimals <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/fmt_number.html">fmt_number</a></span><span class="op">(</span>columns <span class="op">=</span> <span class="fl">6</span><span class="op">:</span><span class="fl">7</span>, decimals <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/fmt_number.html">fmt_number</a></span><span class="op">(</span>columns <span class="op">=</span> <span class="fl">8</span><span class="op">:</span><span class="fl">9</span>, decimals <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<div id="pevchwnukc" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#pevchwnukc table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#pevchwnukc thead, #pevchwnukc tbody, #pevchwnukc tfoot, #pevchwnukc tr, #pevchwnukc td, #pevchwnukc th {
  border-style: none;
}

#pevchwnukc p {
  margin: 0;
  padding: 0;
}

#pevchwnukc .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#pevchwnukc .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#pevchwnukc .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#pevchwnukc .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#pevchwnukc .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pevchwnukc .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pevchwnukc .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pevchwnukc .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#pevchwnukc .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#pevchwnukc .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#pevchwnukc .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#pevchwnukc .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#pevchwnukc .gt_spanner_row {
  border-bottom-style: hidden;
}

#pevchwnukc .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#pevchwnukc .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#pevchwnukc .gt_from_md > :first-child {
  margin-top: 0;
}

#pevchwnukc .gt_from_md > :last-child {
  margin-bottom: 0;
}

#pevchwnukc .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#pevchwnukc .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#pevchwnukc .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#pevchwnukc .gt_row_group_first td {
  border-top-width: 2px;
}

#pevchwnukc .gt_row_group_first th {
  border-top-width: 2px;
}

#pevchwnukc .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pevchwnukc .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#pevchwnukc .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#pevchwnukc .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pevchwnukc .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pevchwnukc .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#pevchwnukc .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#pevchwnukc .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#pevchwnukc .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pevchwnukc .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pevchwnukc .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#pevchwnukc .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pevchwnukc .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#pevchwnukc .gt_left {
  text-align: left;
}

#pevchwnukc .gt_center {
  text-align: center;
}

#pevchwnukc .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#pevchwnukc .gt_font_normal {
  font-weight: normal;
}

#pevchwnukc .gt_font_bold {
  font-weight: bold;
}

#pevchwnukc .gt_font_italic {
  font-style: italic;
}

#pevchwnukc .gt_super {
  font-size: 65%;
}

#pevchwnukc .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#pevchwnukc .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#pevchwnukc .gt_indent_1 {
  text-indent: 5px;
}

#pevchwnukc .gt_indent_2 {
  text-indent: 10px;
}

#pevchwnukc .gt_indent_3 {
  text-indent: 15px;
}

#pevchwnukc .gt_indent_4 {
  text-indent: 20px;
}

#pevchwnukc .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead><tr class="header gt_col_headings">
<th id="Analysis" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Analysis</th>
<th id="Bound" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Bound</th>
<th id="Time" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Time</th>
<th id="N" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">N</th>
<th id="Events" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Events</th>
<th id="Z" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Z</th>
<th id="Probability" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Probability</th>
<th id="AHR" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">AHR</th>
<th id="theta" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">theta</th>
<th id="info" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">info</th>
<th id="info0" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">info0</th>
</tr></thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="Analysis">1</td>
<td class="gt_row gt_left" headers="Bound">Lower</td>
<td class="gt_row gt_right" headers="Time">12</td>
<td class="gt_row gt_right" headers="N">467.6</td>
<td class="gt_row gt_right" headers="Events">100.4</td>
<td class="gt_row gt_right" headers="Z">−1.6449</td>
<td class="gt_row gt_right" headers="Probability">0.0060</td>
<td class="gt_row gt_right" headers="AHR">0.840</td>
<td class="gt_row gt_right" headers="theta">0.175</td>
<td class="gt_row gt_right" headers="info">24.7</td>
<td class="gt_row gt_right" headers="info0">25.1</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Analysis">2</td>
<td class="gt_row gt_left" headers="Bound">Upper</td>
<td class="gt_row gt_right" headers="Time">20</td>
<td class="gt_row gt_right" headers="N">467.6</td>
<td class="gt_row gt_right" headers="Events">194.4</td>
<td class="gt_row gt_right" headers="Z">2.5999</td>
<td class="gt_row gt_right" headers="Probability">0.3057</td>
<td class="gt_row gt_right" headers="AHR">0.738</td>
<td class="gt_row gt_right" headers="theta">0.304</td>
<td class="gt_row gt_right" headers="info">47.4</td>
<td class="gt_row gt_right" headers="info0">48.6</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="Analysis">3</td>
<td class="gt_row gt_left" headers="Bound">Upper</td>
<td class="gt_row gt_right" headers="Time">28</td>
<td class="gt_row gt_right" headers="N">467.6</td>
<td class="gt_row gt_right" headers="Events">261.0</td>
<td class="gt_row gt_right" headers="Z">2.2207</td>
<td class="gt_row gt_right" headers="Probability">0.7359</td>
<td class="gt_row gt_right" headers="AHR">0.700</td>
<td class="gt_row gt_right" headers="theta">0.357</td>
<td class="gt_row gt_right" headers="info">63.8</td>
<td class="gt_row gt_right" headers="info0">65.3</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Analysis">4</td>
<td class="gt_row gt_left" headers="Bound">Upper</td>
<td class="gt_row gt_right" headers="Time">36</td>
<td class="gt_row gt_right" headers="N">467.6</td>
<td class="gt_row gt_right" headers="Events">309.8</td>
<td class="gt_row gt_right" headers="Z">2.0452</td>
<td class="gt_row gt_right" headers="Probability">0.9000</td>
<td class="gt_row gt_right" headers="AHR">0.683</td>
<td class="gt_row gt_right" headers="theta">0.381</td>
<td class="gt_row gt_right" headers="info">76.1</td>
<td class="gt_row gt_right" headers="info0">77.5</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-LachinFoulkes" class="csl-entry" role="listitem">
Lachin, John M., and Mary A. Foulkes. 1986. <span>“Evaluation of Sample Size and Power for Analyses of Survival with Allowance for Nonuniform Patient Entry, Losses to Follow-up, Noncompliance, and Stratification.”</span> <em>Biometrics</em> 42: 507–19.
</div>
<div id="ref-Schoenfeld1981" class="csl-entry" role="listitem">
Schoenfeld, David. 1981. <span>“The Asymptotic Properties of Nonparametric Tests for Comparing Survival Distributions.”</span> <em>Biometrika</em> 68 (1): 316–19.
</div>
</div>
</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/keaven\.github\.io\/gsd-deming\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./proportional-hazards.html" class="pagination-link" aria-label="Proportional hazards">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Proportional hazards</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./pkgs.html" class="pagination-link" aria-label="Introduction to gsdmvn, gsDesign2, and simtrial">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Introduction to gsdmvn, gsDesign2, and simtrial</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/keaven/gsd-deming/edit/master/ahr.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/keaven/gsd-deming/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li><li><a href="https://github.com/keaven/gsd-deming/blob/master/ahr.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></div></div></footer></body></html>